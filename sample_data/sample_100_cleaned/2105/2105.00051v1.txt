note pde approach option pricingxvaarxiv210500051v1 qfinrm 30 apr 2021falko baustian1 martin fencl2 jan pospil2 vladimr vgler2department mathematics university rostock ulmenstrasse 69 18057 rostock germanyntis new technologies information society faculty applied sciencesuniversity west bohemia univerzitn 27328 301 00 plze czech republicreceived 4 2021abstractpaper study partial differential equations pdes model valueadjustments different value adjustments denoted generally xva nowadays addedriskfree financial derivative values pde approach allows easy incorporationaim paper solve pde analytically blackscholes settingnew semiclosed formulas compare widely montecarlo simulationsnumerical solutions pde particular example collateral taken valuespastkeywords value adjustment pde collateral montecarlo simulationmsc classification 91g20 91b70 91g40jel classification g12 c63contents1 introduction2 preliminaries3 methodology31 solution transformation heat equation32 nonnegative payoffs33 boundary conditions34 numerical solution finite differences35 numerical solution transformation heat equation36 numerical solution montecarlo method4 numerical results41 uncollateralized contract x 042 collateral delayed value x v t t0 st t05 conclusioncorrespondingauthor honikkmazcuczintroductionfamous blackscholes model option pricing arbitragefree environment introduced1973 black scholes 1973 merton 1973 pioneering model popularbeginning widely practitioners basic assumptions blackscholes model volatility underlying asset constant hypothesis laterdiscarded rubinstein 1985 observed realmarket prices outofthemoneyoptions short maturity significantly higher predictions model hullwhite 1987 introduced model stochastic volatility fix issue stock marketcrash october 1987 infamous black monday permanently changed shapevolatility surface hull 2009 chapter 183 crash implied volatility developedmarked volatility smile observed today rubinstein 1994 explained feartraders possibility similar event consequence stochastic volatilitymodels hull white 1987 stein stein 1991 heston 1993standard option pricing financial crisis started 2007 substantially changedrules derivative pricing possibility borrow lend moneyriskfree rate crucial assumption mentioned modelsstandardly hedging arguments price valuation options crisisculminated bankruptcy lehman brothers big financial entities conjectureobsolete default trading partner scope classic optionpricing models traders react shortage models included collateraldefault trades parties contract consider potential defaultcounterparty traders respond bilateral counterparty risk credit valueadjustments cva sorenson bollier 1994 jarrow turnbull 1995collateral default counterparty corresponding collateral counterpartybank covered debit value adjustment dva duffie huang 1996 additionadjustments derivative contracts contain collateral called collateralvalue adjustment colva regulated credit support annex csa detailsrisk management hull 2018 convexity adjustments differencesprices collateralized noncollateralized derivatives studied piterbarg 2010funding cost adjustments fca common price adjustments traders use includefunding cost price contract according burgard kjaer 2011a hullwhite 2012 fca theoretical basis traders use hull white2014 studied adjustments focus practical realization existtypes adjustments like capital value adjustments kva margin value adjustments mvaliquidity value adjustments lva restrict cva dva fcaadjustments value derivative subsumed xva comprehensive guidexva book gregory 2020analogy blackscholes approach burgard kjaer 2011b derived partial differential equation pde adjusted derivative price bilateral counterparty riskfunding costs partial differential equation linear marktomarket value defaultconsidered nondefault value derivative nonlinear marktomarket valuegiven adjusted value derivative value adjustments casemeaningful practitioners point view close based riskfree marktomarket contracts follow 2002 isda master agreement1 studylinear partial differential equation introduced burgard kjaer 2013 takes collateralsaccountvalue adjustments normally applied portfolios derivativesconsider single option contract analyze influence different adjustments macroview homogeneous cost view portfolio essentially follows microview single contracts derive analytic solution pde burgard kjaer 2013obtain semiclosed pricing formula value adjustments compare formula widely1 availableonline httpswwwisdaorgbook2002isdamasteragreementenglish cit 20190912montecarlo simulations numerical solutions partial differential equationsarregui salvador vzquez 2017 arregui salvador evovi vzquez 2018problem recently studied heston model salvador oosterlee 2021paper structured following way introduce pde correctionadjusted price xva riskfree price derivative contract discusscollaterals section 2 section 3 introduce pricing formula detailsnumerical schemes numerical results presented section 4 conclude section 5preliminariesconsider generic derivative contract option possibly collateralized issuerb counterparty c economic value v incorporates risk default counterparty issuer net funding costs issuer encounter prior defaultmainly interested correction u v v riskfree blackscholes price vblackscholes pde v derive burgard kjaer 2013 corresponding pdeulet standard blackscholes operator1 2 2 2qs s ss 20 constant volatility qs s effective financing rate marketfactor hedge s study following final value problem function u t su t s au t s r u t s f v t su t s 0t 0 t s 0s 0inhomogeneity f formf fcva fdva ffca fcolvafcva c gc vfdva b gb vffca b hfcolva sx xconstants b c sx hedge error h described b c defaultintensities counterparties h describes size hedge error sx differencecollateral rate riskfree rate x denotes collateralgc rc v x v x xgb v x rb v x xrb rc 0 1 recovery rates derivative position regular bilateralcloseout hedge error hh 1 rb v xpositive negative function defined max 0max 0 respectively remark burgard kjaer 2013 use definition min 0negative resulting slightly different equationsinterested different standard types collaterals uncollateralized derivative contracts x 0 terms fcva fdva ffca simplifyfcva c 1 rc vfdva b 1 rb vffca b 1 rb voneway csa issuer posts collateral provided riskfree value outofthemoneycorresponds x vfcva c 1 rc vfdva 0ffca b 1 rb vgoldplated twoway csa collateral x v cva dva fcacollateral rate equals riskfree rate term fcolva vanishes adjusted price vtwoway csa riskless price vreal world situations likely collateral depends v nonsmoothlynonlinearly discontinuously reading dependencies referreader example isda legal guidelines smart derivatives contracts collateral 2popular choice collateral practitioners value previous daygeneral case x v t t0 s notation t v v t s v t t0 s obtainfcva c rc t v t v v t t0 sfdva b t v rb t v v t t0 sffca b 1 rb t vcollateral typically t denotes current time t0 1252 represents business dayst t0 value underlying asset price previous day vblackscholes option pricev t t0 st t0 n d1 t t0 st t0 st t0 kert tt0 n d2 t t0 st t0 3n standard normal cdfd12 s xr 2 t st sapplying feynmankac theorem pde 1 gives burgard kjaer 2013semiclosed solution formu ucva udva ufca ucolvaucvaudvaufcaucolvac udrb c t uet v u gc v u xu dub udrb c t uet v u gb v u xu dub udrb c t uet h u dusx drb c t uet xu durudr t u exp t rv dv discount factor t u rate rmeasure expectations equations s drifts rate qs s sumdva fca referred funding valuation adjustments fva2 available online httpswwwisdaorg20190912legalguidelinesforsmartderivativescontractscollateralcit 20190912methodologysection present main results particular analytically solvecorresponding pde transformation heat equation present direct relationcorrection riskless price certain contracts nonnegative payoff discussboundary conditions numerical schemes provide details numericsapproaches finite differences semiclosed solution formula montecarlomethodperform standardly change variables time till maturity logarithmstock pricet t x ln sintroduce new functions u xu t s v xv t s applying 5pde 11 2u2 2 qs s 2r b c u f2 xsetqs s 2simplify notation write initial value problem correction u x1 2u2 2r b c u f0 t x r2 xu0 x 0x rpde 6 parabolic unique weak solution evans 2010solution transformation heat equationblack scholes obtained famous formula transforming pde homogeneousheat equation physics want heat equation 6 performsuccessive transformationsstart introducing x erb c u x simplify pde 61 22 2f erb c2 xx x obtain nonhomogeneous heat equationuse suitable shift1 22 2 f erb c2 x0 x u0 x 0 x r write solution 7observez zzx2xe 22 s f vs z dz erb c s ds4 2 sperform substitution2 2 ssolution formz zxey f vs x 2 2 sy dy erb c s dsfinally apply inverse substitutions obtain formula solution 6 termsoriginal variablesz zy 2f vs x 2 sy dy erb c s ds 8u xremark 31 representation solution obtained means fouriertransformu xeikx dxk f u xf k f f v xf v xeikx dxdenotes complex unit apply fourier transform pde 62 k 2 ik r b c f gk fdenotedgk 2 k 2 ik r b cintroduce k egk k transform 9 odeegk fsolved directlykegks fs k dssolution 9 formkegk s fs k dsapply inverse fourier transform obtain solution original equation 6u x f kkeikx dkikx21 2 k2 ikrb c sf s k ds dkdifferent forms 8 10 solution equivalent useexample similar techniques baustian mrzek pospil sobotka 2017nonnegative payoffsderivative contracts like options nonnegative payoff resulting nonnegativeriskless price v derivative v v v 0 consider uncollateralizedcontracts oneway csa derivatives described section 2 term fvalue adjustments simplifies f v c 1 rc b 1 rb v representcorrection u dependence riskless price v1 2u2 2r b c u cf v0 t x r2 xu0 x 0x rcf c 1 rc b 1 rb recall v satisfies blackscholes equation1 2u2 2rv0 t x r2 xv0 x hxx rhx 0 payoff function derivative observe functionsolution 11 nontrivial initial valuecf v0 xb cb ccf vb cfortunately use function w eb c v satisfies w0 x hx1 2w2 2r b c w2 xobtain solutionu xc 1 rc b 1 rb b c1 v xw x v xb cb cinitial value problem 11 trivial initial data use representationsolution solution formula v like blackscholes formula fourier transformbased formula directly derive correction term uboundary conditionsproblems 1 6 defined halfline s line x respectivelywant compare numerical solution problem 6 solution providedmc formula 8 reduce finite interval x case needdefine boundary conditionspde 1 good starting point pde 6 let assumework finite interval 0 smax smax r sufficiently large set s 0pde 1 reducesr b c u b hsolvedb hu t 0erb c tt 1r b cdirichlet boundary condition left pde 1divide pde 1 s 2 approach limit st s 0s s 2limactually assuming behaviour u t s s preciselygrowth u t s s subquadratic large s pricing equations v commonapproach consider socalled zero gamma condition int hout 2017 sec 23t smax 0s 20 t tnatural assume type condition correction ut smax 0s 20 t tsufficiently large smax approach castillo ferreirogarcarodrguez vzquez 2013 arregui salvador vzquez 2017 possibleassume u t smax c0 t c1 ts papers substitute 1compute c0 c1 numerically cases analytically stick13 boundary condition easier implement require additionallengthy computations importantly provides significantly better resultscomparing numerical solution pde montecarlo mc formula 8let consider numbers xmin xmax rxmin 0 xmaxtransformation 5 derived boundary conditions 1213 reasonableconsider boundary conditionsu xminxmaxb herb c 1r b c0 t completing problem 6numerical solution finite differencesgoal subsection introduce approximate scheme transformed problem6 completed boundary conditions 1415 intend use idea method linesseparate discretization time space x leveque 2007 chapter 13problem implemented software matlab possesses useful solversevolution time approximate spatial problem 61415results odes use suitable ode solver matlabiterate time pde problem 6 typical advectiondiffusionreaction equationproblem situated spatial dimension sufficient use finite differencesmentioned previous subsection work interval xmin xmax x letdiscretize interval uniform grid constant step size xi1 xi0 1 nx 1 x0 xmin xnx xmax denote approximate valueu xi ui value f v xi fiacknowledge common use nonuniform grid x presentedworks rouah 2013 chap 10 int hout 2017 sec 42 mappingfunction example hyperbolic sine use rough grid maintainingreasonable density points strike solution changes significantlyapproach useful aims large numerical experiments differentparameters model example low computation cost lookproblem point view numerical mathematics solution 6 figure 1include dramatic oscillations boundary layers achieve reasonablesolution relatively rough uniform grid goal paper compare differentapproaches solving problem 6 different step sizes nonuniform gridnecessary desirableapproximate derivatives 6ui1 2ui ui1xiui1 ui1xi1 nx 1 differences central error o 2 letmention problem diffusiondominated order central differenceapproximating advection term bring oscillations stabilizationnecessary100150figure 1 example solution computed finite differences picture contains3d plot solution x contours solution different values depictedright plotted solution computed case xmin 4 xmax 8 strikek 15 parameters stated sectiondeal boundary condition 15 xmax employ classical idea ghostpoint consider point xnx 1 xnx outside grid pointapproximate second derivative 15 second order central difference yieldsunx 1 2unx unx 1odesui1 ui1ui1 2ui ui12rb c ui fi 1 nx 1 17equation 17 nx contains value unx 1 outside grid valueghost point expressing unx 1 16 substituting 17 nxequationunx unx 1unxr b c unx fnxcomputation value unx boundary xmaxmatlabs ode15s solver evolution 17 18 time knowncoefficient second derivative 6 small problem stiffsafer option use ode15s built deal stiff problems ode45course options evolution time example methods adi type likedouglas method rouah 2013 chap 10 int hout 2017 chap 13 typemethods problems multiple spatial dimensions despite factproblem spatial dimension use adi method split iterative processstages advection diffusion source approachviable better example eulers method lowering restriction cflcondition ode15s solver adaptive time capable dealing kindproblemsnumerical solution transformation heat equationorder evaluate double integral 8 numerically suitable quadrature chosenexist sophisticated quadratures example monographs krylov1962 stoer bulirsch 2002 davis rabinowitz 2007 dahlquist ke 2008clarity numerical comparison use simple trapezoid method let considerequidistant partition interval 0si s0 1 nsgiven s r ns n ns s inner integral needs restrictedbounded interval order trapezoid method applicable let ymax 0 sufficientlylarge number shall specified forthcoming sections let y r ny nny y 2ymax define partition interval ymax ymaxyi ymax y0 1 nyexpress trapezoid valuey 1ns 1 nx1 xuhe xgsi1 yi1 gsi yi y s4 i0 j0gs y gs y x eyrb c sf v s x2 synumerical solution montecarlo methodcurrently widely method evaluate formula 4 subsequent expressions montecarlo simulation incorporation change variablessimplification term dr t u 4 resultsz tu t serb c ut ef v u su st s dut terb c s ef v t y st y st s dscva dva fca colva st modelled geometric brownianmotion change variables 5u xerb c s ef v t s lnst s lnst x ds 20shall compute integral term 20 trapezoid method interval0 partitionsi s 0 1 nss r ns n s ns integral 20 computedxns 11 xg si1 g si s2 i0g si g si x erb c s xx montecarlo estimate corresponding conditional expectation finallyumc x cva x dva x fca x colva xyields numerically computed value 4 practice x usually efficiently estimatedquasimontecarlo method low discrepancy sobol sequences renzittibastani sivorot 2020 classical montecarlo estimates calculated forthcoming section sufficient accuracy comparison purposesnumerical resultssection compare pricing formula 8 montecarlo pricing approachformula 4 numerical solution pde 6 solution obtainedfinite differences method fdm distinguish collateral strategies uncollateralized contract x 0 leads intricate right source term 1 comparedchoices delayed collateral x v t t0 st t0 consider onewaycsa corresponding adjustments similar contracts collateralrecall different collaterals discussed section 2uncollateralized contract x 0fixed parameters 025 qs 003 s 0 r 003 b 002 c 005 rb 04rc 04 sx 0012 x 0 t 2 h 2 valued european optionstrike price k 15tests considered pricing formula 8 benchmark solutioncomputed parameters y 23 s 210 ymax 100 parametersthreshold ones finer discretization larger integration region improveaccuracy significantlyexperiments pursued main directions studied behaviour finitedifference scheme section 34 varying spatial discretization x temporal discretization integration region xmin xmax second experiment focusedmontecarlo formula 21 accuracy respect number simulated paths denoted n order mitigate approximative behaviour boundary condition 18eliminate growing region size case compare values regionlnk 1 lnk 1 0 error quantified estimate lmax normkgklmax max gi x j s 0 1 n j 0 1 nxestimate l2 norm121 nx 1kgkl2gxi1 j1 gxi j 2 xevaluating performance finite difference scheme fixed xmin xmax 5let x 22i 1 4 22j j 1 5 vary results depictedfigure 2 good agreement approaches seen errorindependent temporal discretization fineness caused factode15s solver chooses time step adaptivelyfixed x 26 23 xmin 4 let xmax 4 5 8 vary varyxmin exmin e4 0018 sufficiently close zero taking negative xminprovide difference seen figure 3 influence region truncationnotable extremely small regions exclusively enlargement significantly improveaccuracyfinally set x 21 22 xmin xmax 5 note parameters influencenumber points use compute error schemes 19 21considered montecarlo time step s 210 dependence error montecarlo method number simulated paths n 10305j j 0 4 depicted figure 4collateral delayed value x v t t0 st t0let consider collateral delayed value 3 st t0 approximatedbackwarddiscounted value1 2st t0 st exp t0 qs s103103maxmaxerrorerror102101103102101figure 2 comparison finite difference scheme fd section 34 heat equation formulasection 35 left panel captures situation fixed 26 right paneldepicts case fixed x 260016max00140012error0010008000600040002x maxfigure 3 comparison finite difference scheme fd section 34 heat equation formulasection 35 x 26 23 xmax variabledealing underlying montecarlo simulation performedbrownian bridge pinned t t t0 leads approximative underlying valuet t0 needs adjust time discretization computation integralappropriately partition points hit exactly past time t t0model parameters unchanged compared previous experiments sx002 necessary adjustment denote x1 v t t1 st t1 x2v t t2 st t2 delay terms t1 t2 r0 v xi 0 1 2 differenceright hand 1 expressedf1 f2 b 1 rb sx x1 x2b 1 rb sx values derivatives equal regardless delay tidelay term set t0 1252 assuming 252 trading days year differencevalues derivatives delay x v delay x v t t0 stt0 depicted left panel figure 5 similar test virtue figure 4 heatequation formulation montecarlo simulation right panel figure 5max008error006004002002103104105figure 4 comparison montecarlo solution mc section 36 heat equationformula section 35 variable number simulated paths n005004003maxerror002001001100120140103104105figure 5 left panel contour plot difference valued european optionundelayed collateral x v previousday delayed collateral x v t t0 st t0t0 1252 right panel comparison heat equation formula montecarlosimulation delayed collateralconclusionaim paper bring attention analytical solutions partial differentialequation value adjustment modelling pde approach knowndecade burgard kjaer 2011b presented derivation semiclosed formulaspublished dealing underlying asset easily applytransformation xva pde heat equation known solution obtainfast reliable semiclosed pricing formula confirmed consistent montecarlosimulations numerical solution pde obtained finite differences methodspecial attention paid example collateral taken value pasttypically day considered practice research interestingstudy happens collateral posted daily weekly monthly posesnew analytical numerical challenges inhomogeneity f discontinuousworth mentioning xva considered multidimensional settingmultiple risk factors driving wiener processes instantaneously correlated settingleads pde multiple spatial dimensions suited transformationheat equation presented paper detailed study multidimensional settingscope paper subject future researchanalytic approach practical sense need studyvaluation adjustment underlyings independently order identify individualcontribution risk case analytic formula definitely convenientmontecarlo simulation hand calculating xva highly complex portfolionowadays performed means montecarlo quasimontecarlo simulationsfundingwork partially supported czech science foundation gar grant ga1816680s rough models fractional stochastic volatilityacknowledgementscomputational resources supplied project einfrastruktura cz einfra lm2018140provided program projects large research development innovations infrastructuresreferencesarregui n salvador b vzquez c 2017 cva computing pde models numerical analysisapplications vol 10187 lecture notes comput sci pp 1524 cham springer isbn 9783319570990 doi 10100797833195709902 zbl 136791190 mr3661225arregui n salvador b evovi d vzquez c 2018 total value adjustments europeanoptions stochastic factors mathematical model analysis numerical simulation comput mathappl 764 725740 issn 08981221 doi 101016jcamwa201805012 zbl 142691261 mr3830757baustian f mrzek m pospil j sobotka t 2017 unifying pricing formula stochastic volatility models jumps appl stoch models bus ind 334 422442 issn 15241904doi 101002asmb2248 zbl 142091444 mr3690484black f scholes m 1973 pricing options corporate liabilities j polit econ 813 637654issn 00223808 doi 101086260062 zbl 109291524 mr3363443burgard c kjaer m 2011a balance risk 24 7275 doi 102139ssrn1785262burgard c kjaer m 2011b partial differential equation representations derivatives bilateralcounterparty risk funding costs j credit risk 73 7593 doi 1021314jcr2011131burgard c kjaer m 2013 funding costs funding strategies risk 26 8287 doi 102139ssrn2027195castillo d ferreiro m garcarodrguez j vzquez c 2013 numerical methodssolve pde models pricing business companies different regimes implementation gpus appl mathcomput 21924 1123311257 issn 00963003 doi 101016jamc201305032 zbl 130465186 mr3073276dahlquist g ke b 2008 numerical methods scientific computing vol society industrialapplied mathematics siam philadelphia pa isbn 9780898716443 doi 10113719780898717785mr2412832davis p j rabinowitz p 2007 methods numerical integration dover publications mineolany isbn 9780486453392 corrected reprint second 1984 edition zbl 113965016 mr2401585duffie d huang m 1996 swap rates credit quality j finance 513 921949 issn 15406261doi 1023072329227evans l c 2010 partial differential equations vol 19 graduate studies mathematics american mathematical society providence ri second edn isbn 9780821849743 doi 101090gsm019 zbl 119435001mr2597943gregory j 2020 xva challenge counterparty credit risk funding collateral capital wiley financechichester west sussex uk john wiley sons 4th edn isbn 9781119508977hbk 9781119509004ebookheston s l 1993 closedform solution options stochastic volatility applications bondcurrency options rev financ stud 62 327343 issn 08939454 doi 101093rfs62327 zbl 138435131mr3929676hull j white 2012 fva debate risk 25 8385hull j white 2014 valuing derivatives funding value adjustments fair value financial analj 703 4556 doi 102469fajv70n33hull j c 2009 options futures derivatives prentice hall 7th edn isbn 9780136015864hbkhull j c 2018 risk management financial institutions wiley finance wiley 5th edn isbn 9781119448112hbk 9781119448099ebookhull j c white d 1987 pricing options assets stochastic volatilities j finance422 281300 issn 15406261 doi 101111j154062611987tb02568xint hout k 2017 numerical partial differential equations finance explained introduction computational finance financial engineering explained london uk palgrave macmillan isbn 9781137435682hbk 9781349953813pbk 9781137435699ebook doi 1010579781137435699jarrow r turnbull s m 1995 pricing options financial securities subject credit risk jfinance 501 5385 issn 15406261 doi 1023072329239krylov v 1962 approximate calculation integrals translated arthur h stroud macmillannew yorklondon 1962 zbl 115265005 mr0144464leveque r j 2007 finite difference methods ordinary partial differential equations steadystatetimedependent problems philadelphia pa society industrial applied mathematics siam isbn9780898716290pbk doi 10113719780898717839 zbl 112765080 mr2378550merton r c 1973 theory rational option pricing bell j econ 41 141183 issn 00058556doi 1023073003143 zbl 125791043 mr0496534piterbarg v 2010 funding discounting collateral agreements derivatives pricing risk 23 97102renzitti s bastani p sivorot s 2020 accelerating cva cva sensitivities quasimontecarlo methods wilmott 2020108 7893 doi 101002wilm10860rouah f d 2013 heston model extensions matlab c website wiley finance serieshoboken nj john wiley sons isbn 9781118548257pbk 9781118656471ebook zbl 130491007rubinstein m 1985 nonparametric tests alternative option pricing models reported tradesquotes 30 active cboe classes august 23 1976 august 31 1978 j finance 402455480 doi 101111j154062611985tb04967xrubinstein1994impliedbinomialtreesfinance493771818doi 101111j154062611994tb00079xsalvador b oosterlee c w 2021 total value adjustment stochastic volatility modelcomparison blackscholes model appl math comput 391 125489 19 issn 00963003doi 101016jamc2020125489 mr4149125sorenson e h bollier t f 1994 pricing swap default risk financial anal j 503 2333 issn0015198x doi 102469fajv50n323stein e m stein j c 1991 stock price distributions stochastic volatility analytic approachrev financ stud 44 727752 issn 08939454 doi 101093rfs44727 zbl 06857133stoer j bulirsch r 2002 introduction numerical analysis vol 12 texts applied mathematicsspringerverlag new york edn isbn 038795452x doi 1010079780387217383 zbl 100465001mr1923481