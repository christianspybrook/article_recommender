discrete dipole approximation simulation light scatteringparticles larger wavelengthma yurkinab vp maltsevbc ag hoekstraasection computational science faculty science university amsterdam kruislaan403 1098 sj amsterdam netherlandsinstitute chemical kinetics combustion siberian branch russian academysciences institutskaya str 3 630090 novosibirsk russianovosibirsk state university pirogova str 2 630090 novosibirsk russiaabstractmanuscript investigate capabilities discrete dipole approximationdda simulate scattering particles larger wavelengthincident light optimized publicly available dda programprocesses large number dipoles required simulations numerical simulationslight scattering spheres size parameters x 160 40 refractive indexm 105 2 respectively presented compared exact results mie theoryerrors integral angleresolved scattering quantities generally increase msystematic dependence x computational times increase steeply xm reaching values 2 weeks cluster 64 processors main distinctivefeature program ability parallelize single dda simulationcluster computers allows simulate light scattering large particles likeones considered manuscript current limitations possible waysimprovement discussedkeywords discrete dipole approximation light scattering simulation programcorresponding authors tel 31205257462 fax 31205257490email addresses myurkinscienceuvanl alfonsscienceuvanl1 introductiondiscrete dipole approximation dda general method calculate scatteringabsorption electromagnetic waves particles arbitrary geometry compositiondda proposed purcell pennypacker 1 reviewed draineflatau 1994 2 recent review 3 describes current state ddahistorical development explains equivalence dda methods basedvolume integral equation formulation reader referred review indepthdiscussion ddanumber programs based ddarecently compared penttila et al 4 popular ddscat 5widely researchers 10 years paperpresent new program amsterdam dda adda recently publicdomain 1 main distinctive feature ability parallelize single dda simulationcluster computers allows simulation light scattering large particlesdemonstrated number test cases manuscript validation addasimulating light scattering wavelengthsized particles comparing ddaprograms reported 4section 2 describes adda code showing advantagescompared codes number numerical tests shown section 3 demonstratingdda actually capable processing large particles showing current capabilitiesadda results simulations discussed section 4 errors comparedprevious results smaller particles section 5 concludes manuscriptdiscusses possible future work2 adda codeadda developed period 10 years universityamsterdam 68 main feature distinctive dda codescapability running cluster computers parallelizing single dda computationcontrast ddscat 5 allows farming instantiations ddasimulation different processors allows practically unlimited numberdipoles adda limited memory single 89 recentlyoverall performance code improved significantlyoptimizations specifically singleprocessor mode addas source codedocumentation freely availableadda written ansi c ensures wide portability sourcecodelevel code fully operational linux sequential mode windows basedsystems parallelization multiple processors based geometric decompositionparticle singleprogrammultipledata paradigm parallel computingcode written distributed memory systems message passing interface mpi 2note adda principle run shared memory computers farexplicitly tested fast fourier transform fft matrixvector productsiterative solver performed routines temperton 10advanced package fastest fourier transform west fftw 11generally considerably faster requires separate package installationadda options implemented dipole polarizabilities clausiusmossotti 1radiative reaction correction 12 lattice dispersion relation ldr 13 corrected ldr14 includes iterative methods conjugate gradient applied normalized equationminimization residual norm cgnr 15 bicg stabilized bicgstab 15 bi1httpwwwscienceuvanlresearchscssoftwareaddahttpwwwmpiforumorgcg 16 quasi minimal residual qmr 16 iterative methods employcomplexsymmetric property dda interaction matrix halve calculation time 16default stopping criterion iterative method adda relative normresidual 10 5usual formulation dda written 23i1pi g ij p j eincjtensor dipole polarizability eincident electric field g ij freeispace greens tensor complex symmetric pi unknown dipole polarizationpolarizability tensor diagonal dipoles existscomplex symmetric matrixelementsjijg ij j jidentity tensor interaction matrix addafollowing linear equations solvedij x j x g ij j x j eincijx pi new unknown vector eq 3 equivalent use jacobipreconditioning 15 keeping interaction matrix complexsymmetricdistribution refractive index inside scatterer supported polarizationprescriptions studied jacobipreconditioning improvesconvergence iterative solver flatau showed 17 test cases helpsimprovement important note dda limiteddiagonal symmetric polarizabilities tensor interactionmatrix complexsymmetric qmr bicg efficientadda perform orientation averaging scattering quantities eulerangles particle orientation averaging angle singlecomputation internal fields computing scattering different scattering planescomparably fast averaging euler angles independent ddasimulations averaging performed romberg integration 18adaptively automatically simulating required number different orientationsreach prescribed accuracy limits possible number values orientationangle 2 n 1 n integer symmetries scattererdecrease intervals euler angles average acceleratecalculation feature adda tested recent benchmark study 4features adda include computation scattering tightly focusedgaussian beams 6 checkpoint allow long runs queuing systemsenforce upper limits wall clock time execution usually case massivelyparallel supercomputers calculation radiation forces dipoles 19 userotational symmetry scatterer halve simulation time extended commandline interface features applicability anisotropic scatterers largeset predefined shapes planned implemented near futurefactors allow addas performance compare favorablycodes shown benchmark study penttila et al 4fftw 3 package automatically adapts optimally performparticular hardware adda perform complete 3d fft transformsrun decomposes set 1d transforms data transpositionallows employing fact input data forward transform contains zeros2 gb70 gbrefractive index m10 1010100120140160size parameter xfig 1 current capabilities adda spheres different x m striped regioncorresponds convergence densely hatched region incomplete convergence dashedlines levels memory requirements simulation according rule thumbmain text explanationoutput data backward transform 8 secondimplemented different krylovspacebased iterative solvers allowing choosesuitable particular application known literature 172021demonstrated section 3 best iterative solver dda dependingdetails scattering problem methods outperformdynamic memory allocation optimized data structures allow computationsfft performed real nonvoid dipoles computationalbox decreases addas memory consumption symmetryinteraction matrix decrease memory required fourier transform finallyfloat variables adda represented double precision accelerates convergencecases machine precision important basic operations doubleprecision numbers faster singleprecision ones modern processorsacceleration comes cost increased memory consumption lowercodes 4information adda extensive manual includeddistribution package3 numerical simulationssimulation parameterstests adda v075 compiled intel c compiler v90 maximumpossible optimizations default options addas makefile tests rundutch compute cluster lisa 3 32 nodes dual intel xeon 34 ghz processor4 gb ram ldr common polarization formulation trieddifferent iterative solvers qmr bicg bicgstab defaultstopping criterion 10 5httpwwwsaranluserinfolisadescriptiontable 1 parameters numerical simulationsnumbernumberiterative methoditerationsdipolesabicgstab10526105bicgstab88105bicgstab21106bicgstab71106bicgstab17107bicgstab10033107bicgstab13010390107bicgstab16013108qmr10551105qmr22311221106105qmr59841106qmr21201110bicgstab2174810533107bicgstab61691001015710130103bicgstab292001310qmr134410888105qmr1693010830106qmr816410871106bicg12758817107qmr849611014106bicg6974810541106112qmr2817121106bicg11838310255106qmr5854610121106total number dipoles rectangular computational grid main factor determiningcomputation time iteration spheres number dipoles occupied scatterertimes smallerrelative residual norm500010000150002000025000number iterationsfig 2 convergence qmr iterative solver sphere x 20 m 18 residualfunction iteration number shown linear equations contains 3106unknownsspheres test objects size parameter x varied 20 160refractive index m varied 105 2 limited case real mcurrent capabilities adda shown region xmplane fig 1striped region corresponds convergence densely hatched region correspondscases adda fully converge required residual norm1 week1 daycomputation walltime s1 hour1051 min100120140160size parameter xrelative error qextfig 3 total simulation wall clock time 64 processors spheres different x m timeshown logarithmic scale horizontal dotted lines corresponding minute hour dayweek shown convenience105100120size parameter x140160fig 4 relative errors extinction efficiency logarithmic scale spheres different x105 103 incomplete convergence probably affects final accuracyscattering quantities slightly remove results considerationseparate study required quantify effect section 4 fully convergedresults errors scattering quantities numerical convergence smallertotal errors data showncomplete set xm pairs adda converged shown table 1shows number dipoles wavelength medium md d sizedipole tried equal 10 according rule thumb formulateddraine flatau 2 slightly different varied sizedipole grid optimize parallel efficiency adda 4 total number dipolesrectangular computational grid shown table 1 varied 26105 13108best parallel performance obtained grid size divides number processors addaworks grid size105relative error cos100120size parameter x140160maximum relative error s11fig 5 fig 4 asymmetry parameter105100120140160size parameter xfig 6 maximum relative errors s11 logarithmic scale spheres different x mapproximately determined 318xm3 memory requirements computation timeiteration proportional number dashed lines shown fig 1indicate memory requirements different x m correspond typical memorymodern desktop 2 gb maximum total memorysimulations 70 gb respectivelysphere computed extinction efficiency asymmetry parametermueller matrix elements scattering plane symmetry plane cubicaldiscretization sphere exact results spheres obtained mietheory 22 spherical symmetry adda results calculationspolarization state incident field computation time factorsmaller nonsymmetric scatterers x m employed volumecorrection ensure equal volumes sphere dipole representation 2 notelarge spheres correction extremely smallresultstable 1 shows iterative solver provided best performance particular casenumber iterations achieve convergence fig 2 illustrates specific examplerms relative error s11105100120size parameter x140160fig 7 fig 6 rms relative errorsmieddas11170175180120scattering angle deg150180fig 8 dda results dotted line s11 logarithmic scale sphere x 160 m 105compared results mie theory solid lineconvergence dda iterative solver qmr applied 3106 linearequations obtained sphere x 20 m 18 total simulation wall clocktime t particles shown fig 3 fig 4 fig 5 relative errorsextinction efficiency qext asymmetry parameter cos respectively maximum rootmeansquared rms relative errors s11 range scattering angleshown fig 6 fig 7 respectively errors nontrivial mueller matrixelements behave similar way data showndda results s11 sphere x 160 m 105 comparedmie theory fig 8 inset shows magnification backscattering regionbest knowledge largest particle simulated dda fig 9 fig 10comparisons x 60 m 14 x 20 m 2 respectivelys11miedda120scattering angle deg150180s11fig 9 fig 8 x 60 m 14miedda120scattering angle deg150180fig 10 fig 8 x 20 m 24 discussionconvergence qmr iterative solver shown fig 2 featuring plateaus steepdescents agreement behavior general 16 particular examplesapplication dda 2023 distinctive feature graph comparedliterature data convergence slows iteration number logarithmresidual norm decreases slower linearly probably large sizescatterer loss numerical precision discussiontotal computation times t increase steeply x m fig 3 timedisplayed logarithmic scale covering range 4 seconds 2 weeksm 105 increase t x increasing number dipoles modelscatterer number iterations increase slower pace table 1 larger meffects comparable combining unfavorable scalingapproximately described power law t c m x m 6 m 12noted number iterations t increase monotonically xexample x 80 m 12 x 30 m 14 execution times unusually highcaused large condition number dda interaction matricesparticular particles convergence slow suffer machineprecision determining limit x m adda convergecurrent size limitations dda m 12 practicallyunbearable computation times memory requirements 5 simulations largerm far memory limit shown fig 1 simply processorssolve problem improving numerical performance required dedicatedpreconditioning iterative solver 15 hand extension larger sizesm 12 feasible resources available facilitates examplesimulating scattering visible light biological cells suspensionincrease number iterations m wellknown fact 12172124theoretical foundation details rahola 24 providedtheoretical predictions dependence number iterations m valid scattererssmaller wavelength conclusions applicable scatterersstudied manuscript general reason slowing convergenceincreasing m increased interaction dipoles increased conditionnumber interaction matrix absorption present decrease overallinteraction dipoles large scatterer expected convergencecomplex refractive indices better purely real ones considersuggested budko samokhin 25 based analysis spectrumintegral scattering operator proposition verifiednumerical testsparameter greatly affect computation time convergencethreshold paper set defacto default value 105 2 ensuresnegligibly small numerical errors compared model errors casesnumerical errors small 10 3 difference scatteringquantities simulations 10 3 10 5 significantly smallerdifference exact values data shown fig 2 shows qmrparticular case converges 10 3 2 103 times fasterrespectively 10 5 results simulated particles iterative solverssimilar trends larger acceleration increasing cases data showndetermine optimum particular case decreasecomputation time significantly pursue issuemanuscriptfig 4 shows deterioration accuracy qext increasing mclear dependence x exception single result m 2 resultscos fig 5 behave similar way results good agreement resultsresearchers smaller size parameters 21326 terms errorsdependence m express errors angular dependencies s11 useintegral parameters maximum rms relative errors fig 6 fig 7 respectivelyparameters completely objective significantly influencedvalues s11 deep minima completely irrelevant realexperiments provide consistent measure dda accuracy relateintegral parameters criteria visual agreement examples presentedfig 8 fig 10 errors s11 tendencies integral scatteringquantities errors m 105 relatively large larger m 12range x 60 generally decrease x relative naturemeasured errors huge dynamical range s11 small refractive indices fig8 results smaller size parameters literature 226 similar increaseboundary value m welldefined depends particular hardware restrictionscomputation time 12 convenient value guide readererrors m errors considerably smaller instancemaximum relative errors s11 x 10 m 25 14i smaller 04general differences functions s11 particles comparablelarger wavelength deeper minima larger overall dynamicrange important note refractive indices small 105 rarely ddasimulations 26 hard definite conclusions concerning behaviorerrors casefollows traditional rule thumb 2 discussed statesmd 10 errors cross sections asymmetry parameter expectedpercents maximum errors angular dependence s11 order 2030results qext cos satisfy rule thumb ruledecrease errors orders magnitude decreasing mcut number dipoles computation time casesintegral scattering quantities need calculated small m relative errors s11larger predicted rule thumb factderived based test simulations x smaller 10 2 discussionpossible changes complex refractive index nonspherical shapesconclude rule thumb limited application range x melaborate empirical functions required estimate number dipoles needed reachprescribed accuracy allow realistic estimate dda computationalcomplexity computation time needed reach certain accuracy scatteringquantities particular x m topic left future studytest results shown paper limited real refractive indices sphericallyshaped scatterers following try generalize conclusions complex refractiveindex nonspherical shapes want stress generalizationspeculative numerical tests clearly needed verify expectedaccuracies integral scattering quantities change significantly generalcases accuracy deteriorate increasing real imaginary partsrefractive index situation angleresolved scattering quantities expecteddifferent large relative errors observed paper deep minimaconsequence spherical symmetry purely real refractive index expectedvisual agreement dda results exact solution shown fig 8 fig10 change significantly general cases result smallerrelative errors especially larger x smaller m5 conclusionpaper present adda program simulate light scatteringarbitrarily shaped particles adda parallelize single dda simulation allowslimited memory single adda heavily optimizedallows compare favorably programs based dda runningsingle processor showed capabilities simulating light scattering spheres x160 m 2 maximum reachable x cluster 64 modern processorsdecrease rapidly increasing m 160 m 105 2040 dependingconvergence threshold m 2 slow convergence iterativesolver leading practically unbearable computation times expected larger particlesizes reached m significant imaginaryerrors integral angleresolved scattering quantities systematicdependence x generally increase m errors qext cos range001 6 maximum rms relative errors s11 ranges 02180041 respectively error predictions traditional rule thumb limitedapplication range x m describes upper limit errors qext cosaccount decrease errors mcurrently adda capable simulating light scattering biologicalcells suspension performance cases improvedimprovements left future work include improving convergence iterativesolver preconditioning desirable conduct detailed study dependenceaccuracy final results size dipole convergence thresholdsiterative solver different scatterers study result reductioncomputation time provide realistic estimate dda complexity wide range xmacknowledgementsthank gorden videen critically reading manuscript anonymous reviewervaluable comments research supported siberian branch russian academysciences grant 200603references1 purcell em pennypacker cr scattering adsorption light nonspherical dielectric grainsastrophys j 19731867057142 draine bt flatau pj discretedipole approximation scattering calculations j opt soc199411149114993 yurkin ma hoekstra ag discrete dipole approximation overview recent developments jquant spectrosc radiat transf 2007 doi101016jjqsrt2007010344 penttila zubko e lumme k muinonen k yurkin ma draine bt rahola j hoekstra ag shkuratovy comparison discrete dipole implementations exact techniques j quant spectrosc radiattransf 2007 doi101016jjqsrt2007010265 draine bt flatau pj user guide discrete dipole approximation code ddscat 61httpxxxarxivorgabsastroph0409262 20046 hoekstra ag simulations elastic light scattering phd thesis university amsterdamamsterdam 19947 hoekstra ag sloot pma coupled dipole simulations elastic light scattering parallel systems int jmod phys c 199566636798 hoekstra ag grimminck md sloot pma large scale simulations elastic light scattering fastdiscrete dipole approximation int j mod phys c 19989871029 yurkin ma semyanov ka tarasov pa chernyshev av hoekstra ag maltsev vp experimentaltheoretical study light scattering individual mature red blood cells scanning flow cytometrydiscrete dipole approximation appl opt 2005445249525610 temperton c selfsorting mixedradix fast fourier transforms j comp phys 19835212311 frigo m johnson sg fftw adaptive software architecture fft proc icassp 199831381138412 draine bt discretedipole approximation application interstellar graphite grains astrophysj 198833384887213 draine bt goodman jj clausiusmossotti wavepropagation polarizable point latticediscrete dipole approximation astrophys j 199340568569714 gutkowiczkrusin d draine bt propagation electromagnetic waves rectangular latticepolarizable points httpxxxarxivorgabsastroph0403082 200415 barrett r berry m chan tf demmel j donato j dongarra j eijkhout v pozo r romine c van dervorst ha templates solution linear systems building blocks iterative methods 2nd edsiam 199416 freund rw conjugate gradienttype methods linearsystems complex symmetrical coefficientmatrices siam j sci stat comp 19921342544817 flatau pj improvements discretedipole approximation method computing scatteringabsorption opt lett 1997221205120718 davis pj rabinowitz p methods numerical integration new york academic press 197519 hoekstra ag frijlink m waters lbfm sloot pma radiation forces discretedipoleapproximation j opt soc 2001181944195320 rahola j solution dense systems linear equations discretedipole approximation siam j scicomp 199617788921 fan zh wang dx chen rs yung ekn application iterative solvers discrete dipoleapproximation method computing electromagnetic scattering microwave opt tech lett2006481741174622 bohren cf huffman dr absorption scattering light small particles new york wiley 198323 rahola j iterative solution dense linear systems arising integral equations appl parall computlect comp sci 1998154146046724 rahola j eigenvalues volume integral operator electromagnetic scattering siam j scicomp 2000211740175425 budko nv samokhin ab spectrum volume integral operator electromagnetic scattering siamj sci comp 20062868270026 hoekstra ag rahola j sloot pma accuracy internal fields volume integral equation simulationslight scattering appl opt 19983784828497