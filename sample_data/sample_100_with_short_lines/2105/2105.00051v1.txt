a note on a pde approach to option pricing
under xva

arxiv210500051v1 qfinrm 30 apr 2021

falko baustian1  martin fencl2  jan pospil2  and vladimr vgler2
1

department of mathematics university of rostock ulmenstrasse 69 18057 rostock germany
2
ntis  new technologies for the information society faculty of applied sciences
university of west bohemia univerzitn 27328 301 00 plze czech republic

received may 4 2021
abstract
in this paper we study partial differential equations pdes that can be used to model value
adjustments different value adjustments denoted generally as xva are nowadays added to
the riskfree financial derivative values and the pde approach allows their easy incorporation
the aim of this paper is to show how to solve the pde analytically in the blackscholes setting
to get new semiclosed formulas that we compare to the widely used montecarlo simulations
and to the numerical solutions of the pde particular example of collateral taken as the values
from the past will be of interest

keywords value adjustment pde collateral montecarlo simulation
msc classification 91g20 91b70 91g40
jel classification g12 c63

contents
1 introduction

2

2 preliminaries

3

3 methodology
31 solution by transformation to heat equation          
32 nonnegative payoffs                       
33 boundary conditions                       
34 numerical solution using finite differences           
35 numerical solution using the transformation to heat equation
36 numerical solution using the montecarlo method      








5
5
6
7
8
9
10

4 numerical results
41 uncollateralized contract x  0                            
42 collateral as the delayed value x  v t  t0  st  t0                

11
11
11

5 conclusion

13

 corresponding

author honikkmazcucz

1














































































1

introduction

the famous blackscholes model for option pricing in an arbitragefree environment was introduced
in 1973 by black and scholes 1973 and merton 1973 the pioneering model was very popular
in the beginning and widely used by practitioners one of the basic assumptions of the blackscholes model is that the volatility of the underlying asset is constant this hypothesis was later
discarded after rubinstein 1985 observed that the realmarket prices of outofthemoney call
options with short maturity were significantly higher than the predictions of the model hull and
white 1987 introduced a model with stochastic volatility to fix this issue the stock market
crash of october 1987 with the infamous black monday permanently changed the shape of the
volatility surface see hull 2009 chapter 183 after the crash the implied volatility developed
the marked volatility smile as observed today that rubinstein 1994 explained with the fear
of traders regarding the possibility of a similar event as a consequence stochastic volatility
models by hull and white 1987 stein and stein 1991 heston 1993 and others became
the standard in option pricing the financial crisis that started in 2007 substantially changed
the rules for derivative pricing again the possibility to borrow and lend any amount of money
at a riskfree interest rate is a crucial assumption of all the above mentioned models since its
standardly used in the hedging arguments for the price valuation of the options as the crisis
culminated in the bankruptcy of lehman brothers and other big financial entities this conjecture
became obsolete since the default of a trading partner is not in the scope of the classic option
pricing models the traders had to react to this shortage in the models and included a collateral
against default in many trades both parties of a contract have to consider the potential default
of the counterparty the traders respond to this bilateral counterparty risk with credit value
adjustments cva sorenson and bollier 1994 and jarrow and turnbull 1995 to have a
collateral against default of the counterparty the corresponding collateral of the counterparty
eg a bank is covered by a debit value adjustment dva duffie and huang 1996 in addition
to this adjustments derivative contracts can also contain a collateral also called a collateral
value adjustment colva regulated by the credit support annex csa for more details on
risk management see hull 2018 convexity adjustments that describe the differences between
the prices of collateralized and noncollateralized derivatives were studied by piterbarg 2010
funding cost adjustments fca are other common price adjustments that traders use to include
funding cost in the price of the contract according to burgard and kjaer 2011a and hull and
white 2012 fca have no theoretical basis since traders use them anyway hull and white
2014 studied the adjustments with focus on their practical realization there exist also other
types of adjustments like capital value adjustments kva margin value adjustments mva and
liquidity value adjustments lva but we will restrict ourselves just to cva dva and fca the
various adjustments to the value of the derivative are subsumed as xva a comprehensive guide
to xva is the book by gregory 2020
in analogy to the blackscholes approach burgard and kjaer 2011b derived a partial differential equation pde for the adjusted derivative price under bilateral counterparty risk and
funding costs the partial differential equation is linear if the marktomarket value at default is
considered to be the nondefault value of the derivative and nonlinear if the marktomarket value
is given by the adjusted value of the derivative with all value adjustments the latter case is less
meaningful from the practitioners point of view since the close out is based in the riskfree marktomarket for contracts that follow the 2002 isda master agreement1  hence we will study the
linear partial differential equation introduced in burgard and kjaer 2013 which takes collaterals
into account
value adjustments are normally applied to portfolios with various derivatives nevertheless we
consider a single option contract to analyze the influence of the different adjustments the macro
view ie the homogeneous cost view for the whole portfolio essentially follows from the micro
view of single contracts we derive the analytic solution of the pde of burgard and kjaer 2013
obtain a semiclosed pricing formula for the value adjustments and compare the formula to widely
1 available

online at httpswwwisdaorgbook2002isdamasteragreementenglish cit 20190912

2

used montecarlo simulations and numerical solutions of the partial differential equations as in
arregui salvador and vzquez 2017 and arregui salvador evovi and vzquez 2018 the
problem has recently been studied for the heston model in salvador and oosterlee 2021
the paper is structured in the following way we introduce the pde for the correction between
the adjusted price with xva and the riskfree price of a derivative contract and we discuss various
collaterals in section 2 in section 3 we introduce the pricing formula and give details on the
numerical schemes before numerical results are presented in section 4 we conclude in section 5

2

preliminaries

we consider a generic derivative contract eg option possibly collateralized between an issuer
b and a counterparty c with an economic value v that incorporates the risk of default of counterparty and issuer and any net funding costs the issuer may encounter prior to own default we
are mainly interested in the correction u  v  v to the riskfree blackscholes price v  using
the blackscholes pde for v one can derive burgard and kjaer 2013 the corresponding pde
for u 
let a be the standard blackscholes operator
a


1 2 2 2
 qs  s s
 s

2
s 2
s

where   0 is the constant volatility and qs  s is the effective financing rate of the market
factor hedge s we will study the following final value problem for function u t s

 u t s  au t s  r     u t s  f v t s
b
c
t

u t s  0

for t  0 t  s  0

1

for s  0

where the inhomogeneity f has the form

f  fcva  fdva  ffca  fcolva 
fcva  c gc  v 

fdva  b gb  v 
ffca  b  h 

fcolva  sx  x

with constants b  c  sx and the hedge error h described below here b  c are the default
intensities of the counterparties h describes the size of the hedge error and sx is the difference
between the collateral rate and the riskfree rate x denotes the collateral and we have
gc  rc v  x  v  x  x
gb  v  x  rb v  x  x

where rb  rc  0 1 are the recovery rates of the derivative position for this regular bilateral
closeout the hedge error h becomes
h  1  rb v  x 

2

the positive and negative part of a function  are defined as   max 0 and  
max 0 respectively we remark that burgard and kjaer 2013 use the definition min 0
for the negative part resulting in slightly different equations

3

we are interested in different standard types of collaterals for uncollateralized derivative contracts we have x  0 and the terms fcva  fdva and ffca simplify to
fcva  c 1  rc v  

fdva  b 1  rb v  

ffca  b 1  rb v  

in oneway csa the issuer posts collateral provided that the riskfree value is outofthemoney
that corresponds to x  v  and we get
fcva  c 1  rc v  

fdva  0

ffca  b 1  rb v  

for goldplated twoway csa with collateral x  v there are no cva dva and fca if the
collateral rate equals the riskfree rate then the term fcolva vanishes and the adjusted price v
of a twoway csa becomes the riskless price v 
in real world situations there is most likely a collateral that depends on v nonsmoothly
nonlinearly or even discontinuously for further reading about these dependencies we refer the
reader for example to isda legal guidelines for smart derivatives contracts collateral 2 
a popular choice for a collateral among practitioners is the value from the previous day ie in
more general case x  v t  t0  s with the notation t v  v t s  v t  t0  s we obtain
fcva  c rc t v   t v   v t  t0  s

fdva  b t v   rb t v   v t  t0  s
ffca  b 1  rb t v  

for this collateral typically t denotes the current time t0  1252 represents one business day
and hence st  t0  is the value of the underlying asset price from the previous day if v is the
blackscholes call option price we have that
v t  t0  st  t0   n d1 t  t0  st  t0 st  t0   kert tt0  n d2 t  t0  st  t0  3
where n  is the standard normal cdf and




1
1
x
d12 s x  
 r   2 t  s 
ln
k
2
 t s
applying the feynmankac theorem to pde 1 gives us burgard and kjaer 2013 the
semiclosed solution in the form
u  ucva  udva  ufca  ucolva 

4

with
z

t

ucva  

z

t

udva  

t

ufca  

z

t

ucolva  

z

c udrb c t uet v u  gc v u xu du

t

b udrb c t uet v u  gb v u xu du

t

b udrb c t uet h u du

t

sx drb c t uet xu du

t

 ru
where dr t u  exp  t rv dv is the discount factor between t and u for a rate r the
measure of the expectations in these equations is such that s drifts at rate qs  s  the sum of
dva and fca is sometimes referred to as funding valuation adjustments fva
2 available online at httpswwwisdaorg20190912legalguidelinesforsmartderivativescontractscollateral
cit 20190912

4

3

methodology

in this section we present our main results in particular we show how to analytically solve the
corresponding pde by a transformation to the heat equation and present a direct relation between
the correction and the riskless price for certain contracts with nonnegative payoff we discuss
the boundary conditions for the numerical schemes and provide details on the numerics of all
three used approaches finite differences the semiclosed solution formula and the montecarlo
method
we perform the standardly used change of variables to the time till maturity and the logarithm
of the stock price
  t  t and x  ln s
5

and introduce new functions u x 
 u t s and v x 
 v t s after applying 5 to the
pde 1 we get


u
1
u
1 2u
  2 2  qs  s   2
 r  b  c u  f

2 x
2
x
if we set

1
  qs  s   2
2
to simplify the notation then we can write the initial value problem for the correction u x as

u
1 2u
u

 2 2  
 r  b  c u  f
for   0 t  x  r
6

2 x
x

u0 x  0
for x  r

the pde 6 is parabolic and has a unique weak solution evans 2010

31

solution by transformation to heat equation

black and scholes obtained their famous formula by transforming the pde to the homogeneous
heat equation from physics if we want to get a heat equation from 6 we have to perform
successive transformations
we start by introducing  x  erb c  u x to simplify the pde 6 to
 
 
1  2 
 2 2  
 f  erb c  

2 x
x
  x   x    to obtain the nonhomogeneous heat equation
next we use a suitable shift 
 
 
1  2 

  2 2  f  erb c  

2 x
 0 x  u0 x  0 for all x  r and we can write the solution of 7 as
we observe that 


z  z 
zx2
1


  x  
q

e 22  s  f vs z dz  erb c s ds
1
2
0

4 2    s
we perform one more substitution

zx
yp
2 2   s

to have the solution in the form

z  z 
p
2
1
  x   
ey  f vs x  2 2   sy dy erb c s ds

 0

5

7

finally we apply the inverse substitutions to obtain the formula for the solution of 6 in terms
of the original variables

z  z 
p
1
y 2
e
 f vs x    2  sy dy erb c  s ds 8
u x   
 0

remark 31 another representation of the same solution can be obtained by means of the fourier
transform
z 
u xeikx dx
 k  f u x 

z 

f  k  f f v x 
f v xeikx dx


where i denotes the complex unit if we apply the fourier transform to the pde 6 we get
 
1
   2 k 2   ik  r  b  c   f  gk  f

2
where we denoted

9

1
gk    2 k 2  ik  r  b  c 
2

we introduce  k  egk  k to transform 9 to the ode
 
 egk f

that can be solved directly
 k  



z

egks fs k ds

0

hence the solution of 9 has the form
 k  

z



egk s fs k ds

0

and we can apply the inverse fourier transform to obtain the solution of the original equation 6
z 
1
1
u x  f  k 
 keikx dk
2 

z 
z 
1
ikx
 21 2 k2 ikrb c  s 
f s k ds dk
10

e
e
2 
0
to show that two different forms 8 and 10 of the solution are equivalent one may use for
example similar techniques as baustian mrzek pospil and sobotka 2017

32

nonnegative payoffs

many derivative contracts like call options have a nonnegative payoff resulting in a nonnegative
riskless price v of the derivative ie we have v  v  and v   0 if we consider uncollateralized
contracts or oneway csa for such derivatives as described in section 2 then the term f for the
value adjustments simplifies to f v  c 1  rc   b 1  rb v and we can represent the
correction u in dependence of the riskless price v we get

u
1  2u
u

 2 2  
 r  b  c u  cf v
for   0 t  x  r
11

2 x
x

u0 x  0
for x  r
6

with cf  c 1  rc   b 1  rb  and recall that v satisfies the blackscholes equation

v
u
1 2u

 2 2  
 rv
for   0 t  x  r

2 x
x

v0 x  hx
for x  r
where hx  0 is the payoff function of the derivative we observe that the function
solution of 11 but has the nontrivial initial value


cf v
cf
0 x 
hx
b  c
b  c

cf v
b c

is a

fortunately we can make use of the function w  eb c  v that satisfies w0 x  hx and
w
1 2w
w
 2 2  
 r  b  c w

2 x
x
to obtain the solution
u x 


c 1  rc   b 1  rb   b c 
cf
e
 1 v x
w x  v x 
b  c
b  c

of the initial value problem 11 with trivial initial data we can use this representation of the
solution with any solution formula for v like the blackscholes formula or a fourier transform
based formula to directly derive the correction term u

33

boundary conditions

both problems 1 and 6 are defined either on a halfline in s or a line in x respectively however
if we want to compare the numerical solution of the problem 6 with the solution provided by
mc or formula 8 we must reduce ourselves to a finite interval in x in such case we need to
define boundary conditions
the pde in 1 is a good starting point here rather than the pde in 6 let us assume that
we work on the finite interval 0 smax  with smax  r sufficiently large if we set s  0 the
pde in 1 reduces to
u
 r  b  c   u  b  h 
t
which can be solved to get


b h
u t 0 
erb c tt   1 
12
r  b  c
hence we have this dirichlet boundary condition on the left for the pde in 1
now if we divide the pde in 1 by s 2 and approach the limit s   we get
2u
t s  0
s s 2
lim

we are actually assuming here some behaviour of u t s as s   more precisely the
growth of u t s in s should be subquadratic for large s in pricing equations for v  a common
approach is to consider the socalled zero gamma condition int hout 2017 sec 23 ie
2v
t smax   0
s 2

0  t  t

and hence it is natural to assume the same type of condition for the correction u
2u
t smax   0
s 2
7

0  t  t

13

for some sufficiently large smax  this approach was also already used eg by castillo ferreiro
garcarodrguez and vzquez 2013 and arregui salvador and vzquez 2017 it is possible
to assume here u t smax   c0 t  c1 ts as it was done in these papers substitute it into 1
and compute c0  c1 either numerically or in some cases also analytically however we will stick
with 13 as our boundary condition it is easier to implement does not require any additional
lengthy computations and most importantly it provides us with significantly better results when
comparing the numerical solution of the pde to montecarlo mc or formula 8
let us consider two numbers xmin  xmax  r such that
  xmin  0  xmax  
due to the transformation 5 and derived boundary conditions 1213 it seems reasonable to
consider boundary conditions
u xmin  
2u
 xmax  
x2



b h
erb c   1 
r  b  c
0

for all   0 t  completing the problem 6

34

numerical solution using finite differences

the goal of this subsection is to introduce the approximate scheme for the transformed problem
6 completed by boundary conditions 1415 we intend to use the idea of the method of lines
ie a separate discretization in time  and space x see eg leveque 2007 chapter 13 the
whole problem is implemented in the software matlab which possesses several useful solvers for
the evolution in time hence we will approximate the spatial part of the problem 61415
which results in the system of odes then we will use a suitable ode solver in matlab to
iterate it in time the pde of the problem 6 is typical advectiondiffusionreaction equation
since the problem is situated in one spatial dimension it is sufficient to use finite differences
as we mentioned in the previous subsection we work on the interval xmin  xmax  in x let
us discretize this interval by the uniform grid with constant step size   xi1  xi for i 
0 1     nx  1 hence there is x0  xmin and xnx  xmax  we denote the approximate value of
u xi  by ui and the value of f v  xi  by fi 
we acknowledge that it is quite common to use a nonuniform grid in x as was presented in
other works eg rouah 2013 chap 10 or int hout 2017 sec 42 where the mapping
function can be for example hyperbolic sine one can then use very rough grid while maintaining
reasonable density of points around the strike where the solution changes most significantly this
approach can be useful if one aims to make large amount of numerical experiments for different
parameters of the model for example with low computation cost however if we look at our
problem from the point of view of numerical mathematics the solution of 6 see figure 1 does
not include any dramatic oscillations or boundary layers hence we can achieve a reasonable
solution with relatively rough uniform grid since our goal in this paper is to compare different
approaches of solving the problem 6 eg for different step sizes  using the nonuniform grid
is not necessary or even desirable
we approximate derivatives in 6 by
ui1  2ui  ui1
2u
 xi  
x2
2

and

u
ui1  ui1
 xi  
x
2

for every i  1     nx  1 both of these differences are central with the error o 2  let
us mention here that since our problem is diffusiondominated the first order central difference
approximating the advection term does not bring in any oscillations and thus no stabilization is
necessary
8

0

2

15
50

1
100
05

150

0

figure 1 example of the solution computed by finite differences the first picture contains the
3d plot of the solution in x   contours of the solution for different values of  are depicted on
the right the plotted solution was computed for the case xmin  4 xmax  8 and the strike
k  15 the other parameters are stated in the next section
to deal with the boundary condition 15 at xmax  we employ the classical idea of a ghost
point ie we consider the point xnx 1  xnx   outside of the grid with this point we can
approximate the second derivative in 15 again by the second order central difference which yields
unx 1  2unx  unx 1
 0
2

16

hence we have the system of odes
ui
ui1  ui1
1
ui1  2ui  ui1

 2 
rb c ui fi  for i  1     nx 1 17

2
2
2
the equation 17 for i  nx contains the value unx 1 outside of the grid ie the value at the
ghost point expressing unx 1 from 16 and substituting it into 17 for i  nx give us the
equation
unx  unx 1
unx
18

 r  b  c   unx  fnx 


for the computation of the value unx at the boundary xmax 
we are using matlabs ode15s solver for the evolution of 17 18 in time it is known that
if the coefficient in front of the second derivative in 6 is small the problem could be stiff hence
it is safer option to use ode15s which is built to deal with stiff problems rather than ode45
there are of course other options for the evolution in time for example methods of adi type like
douglas method  see eg rouah 2013 chap 10 or int hout 2017 chap 13 this type
of methods is often used for problems in multiple spatial dimensions despite the fact that our
problem is in one spatial dimension we could use adi method to split the iterative process into
three stages the advection part the diffusion part and the source part this approach is very
viable and would be better than for example eulers method lowering the restriction of the cfl
condition however ode15s solver is adaptive in time and very capable of dealing with this kind
of problems as well

35

numerical solution using the transformation to heat equation

in order to evaluate the double integral in 8 numerically a suitable quadrature has to be chosen
although there exist many sophisticated quadratures see for example monographs by krylov
1962 stoer and bulirsch 2002 davis and rabinowitz 2007 dahlquist and ke 2008 for
9

the clarity of our numerical comparison we use the simple trapezoid method let us consider an
equidistant partition of the interval 0  
si  i  s 

i  0 1     ns

for given s  r and ns  n such that ns  s    the inner integral needs to be restricted to a
bounded interval in order for the trapezoid method to be applicable let ymax  0 be sufficiently
large number which shall be specified in the forthcoming sections and let y  r and ny  n be
such that ny  y  2ymax  we then define the partition of the interval ymax  ymax  as
yi  ymax  i  y 

i  0 1     ny 

we can now express the trapezoid value as
y 1
ns 1 nx
1 x
uhe  x   
gsi1  yi1   gsi  yi  y s 
4  i0 j0

19

in which
gs y  gs y  x  ey

36

2

rb c  s

f v s x   

p
2  sy

numerical solution using the montecarlo method

currently the most widely used method to evaluate the formula 4 with the subsequent expressions is the montecarlo simulation the incorporation of a change of variables and the
simplification of the term dr t u in 4 results in
z t
u t s  
erb c ut ef v u su  st  s du
t



z

t t

0

erb c s ef v t  y st  y  st  s ds

in which    cva dva fca colva  and st is modelled as the geometric brownian
motion after the change of variables 5 we get
z 
u  x  
erb c s ef v t    s lnst    s  lnst     x ds 20
0

we shall compute the integral term in 20 again via the trapezoid method on the interval
0   with partition
si  i  s  i  0 1     ns

with s  r ns  n and s  ns    the integral 20 can be now computed as
  x  

ns 1
1 x
g si1   g si s
2 i0

in which
g si   g si  x  erb c s  x
where  x is the montecarlo estimate of the corresponding conditional expectation finally
umc  x  cva  x  dva  x  fca  x  colva  x

21

yields the numerically computed value of 4 in practice  x is usually efficiently estimated
using the quasimontecarlo method with low discrepancy sobol sequences  see eg renzitti
bastani and sivorot 2020 the classical montecarlo estimates will be calculated in the forthcoming section which is sufficient for the accuracy comparison purposes
10

4

numerical results

in this section we compare the pricing formula 8 with the montecarlo pricing approach using
the formula 4 and a numerical solution of the pde 6 namely with the solution obtained
using the finite differences method fdm also we distinguish two collateral strategies the uncollateralized contract x  0 which leads to more intricate right source term of 1 compared
to other choices and the delayed collateral x  v t  t0  st  t0  we do not consider oneway
csa since the corresponding adjustments are quite similar to contracts with no collateral we
recall that the different collaterals were discussed in section 2

41

uncollateralized contract x  0

we fixed parameters   025 qs  003 s  0 r  003 b  002 c  005 rb  04
rc  04 sx  0012 x  0 t  2 h as in 2 and we valued the european call option with
strike price k  15
for all the tests we considered the pricing formula 8 to be the benchmark solution which we
computed with parameters y  23  s  210  ymax  100 these parameters seem to be the
threshold ones such that finer discretization and larger integration region would not improve the
accuracy significantly
the experiments pursued two main directions first we studied the behaviour of the finite
difference scheme in section 34 while varying the spatial discretization x  the temporal discretization  and the integration region xmin  xmax  the second experiment is focused on the
montecarlo formula 21 and its accuracy with respect to the number of simulated paths denoted by n  in order to mitigate the approximative behaviour of the boundary condition 18
and to eliminate the growing region size in the latter case we compare the values in the region
  lnk  1 lnk  1  0   the error was quantified via the estimate of the lmax norm
ie
kgklmax  max gi  x  j  s   i  0 1     n  j  0 1     nx 
and the estimate of the l2 norm
 12

nx
 1 n
x 1
x
kgkl2  
gxi1  j1   gxi  j 2 x   
i0

j0

while evaluating the performance of the finite difference scheme we fixed xmin  xmax  5
and let x  22i  i  1     4 and   22j  j  1     5 vary the results are depicted in
figure 2 which show a good agreement of the two approaches as can be seen the error is almost
independent of the temporal discretization fineness which can be caused by the fact that the
ode15s solver chooses the time step adaptively
next we fixed x  26    23  xmin  4 and let xmax  4 5     8 vary we do not vary
xmin  because exmin  e4  0018 is sufficiently close to zero and taking more negative xmin would
not provide much difference as can be seen in figure 3 the influence of the region truncation is
notable for extremely small regions exclusively further enlargement does not significantly improve
the accuracy
finally we set x  21    22  xmin  xmax  5 note that these parameters influence
only the number of points we use to compute the error since only the schemes 19 21 were
considered and the montecarlo time step s  210  the dependence of the error of the montecarlo method on the number of simulated paths n  10305j  j  0     4 is depicted in figure 4

42

collateral as the delayed value x  v t  t0  st  t0 

let us now consider the collateral to be the delayed value as in 3 where st  t0  is approximated
by its backwarddiscounted value ie
ff

1 2
st  t0   st exp t0 qs  s    
2
11

103

103
l

12

l

12

l

11

l

max
2

max
2

10
9

error

error

10

8

8
7
6

6

5
4

4
3

2

2
102

101

103

102

101

x

figure 2 comparison of finite difference scheme fd section 34 and the heat equation formula
he section 35 the left panel captures the situation with fixed   26 and the right panel
depicts the case with fixed x  26 

l

0016

l

max
2

0014
0012

error

001
0008
0006
0004
0002
0
3

4

5

6

7

8

9

x max

figure 3 comparison of finite difference scheme fd section 34 and the heat equation formula
he section 35 with x  26    23 and xmax variable
when dealing with one underlying only montecarlo simulation can be performed using the
brownian bridge pinned at t and t  t0 which leads to the same approximative underlying value
at t  t0  also one needs to adjust the time discretization in the computation of the integral
appropriately for the partition points to hit exactly the past time t  t0 
the model parameters are unchanged compared to the previous experiments except for sx 
002 this is a necessary adjustment indeed if we denote x1  v t  t1  st  t1  x2 
v t  t2  st  t2  for any delay terms t1  t2  r
0 then since v  xi  0 for i  1 2 the difference
of the right hand side of 1 can be expressed as
f1  f2  b 1  rb   sx x1  x2 
if b 1  rb   sx the values of the same derivatives are equal regardless of the delay ti 
the delay term was set to be t0  1252 assuming 252 trading days per year the difference
between the values of the derivatives with no delay x  v  and with delay x  v t  t0  st 
t0  is depicted in the left panel of figure 5 similar test in the virtue of figure 4 for the heat
equation formulation and the montecarlo simulation is show in the right panel of figure 5

12

01

l
l

max
2

008

error

006

004

002

0

002
103

104

105

n

figure 4 comparison of the montecarlo solution mc section 36 and the heat equation
formula he section 35 for variable number of simulated paths n 
2

005

05

18

l
l

16
14

1

004

15

003

max
2

error

12
2

1
08

002

25

001
06
3

04

0
35

02

001

0
20

40

60

80

100

120

140

10

5

103

s

104

105

n

figure 5 left panel contour plot of the difference of the valued of the european call option with
the undelayed collateral x  v and the previousday delayed collateral x  v t  t0  st  t0 
with t0  1252 right panel the comparison of the heat equation formula and the montecarlo
simulation for the delayed collateral

5

conclusion

the aim of this paper was to bring attention to analytical solutions of the partial differential
equation used in value adjustment modelling although the pde approach is known for more
than a decade burgard and kjaer 2011b presented derivation of semiclosed formulas has not
been published until now when dealing with one underlying asset only we can easily apply the
transformation of the xva pde to the heat equation with known solution and hence obtain a
fast and reliable semiclosed pricing formula that confirmed to be consistent with the montecarlo
simulations and with the numerical solution of the pde obtained by the finite differences method
a special attention was paid to the example with collateral taken as the value from the past
typically one day back is considered in practice as a further research it might be interesting to
study also what happens if the collateral is posted daily weekly monthly etc this however poses
new analytical and numerical challenges since the inhomogeneity f is then discontinuous
it is worth mentioning that xva is often considered in a multidimensional setting ie with
multiple risk factors whose driving wiener processes are instantaneously correlated such a setting
then leads to a pde with multiple spatial dimensions that could also be suited for transformation

13

to heat equation as presented in this paper a detailed study of the multidimensional setting
was not in the scope of this paper but will be a subject of future research nevertheless our
analytic approach still might be of practical interest in the sense that one may need to study the
valuation adjustment for each of the underlyings independently in order to identify their individual
contribution to the risk in this case an analytic formula is definitely much more convenient than
any montecarlo simulation on the other hand calculating xva for highly complex portfolio is
nowadays performed only by means of montecarlo and quasimontecarlo simulations

funding
the work was partially supported by the czech science foundation gar grant no ga1816680s rough models of fractional stochastic volatility

acknowledgements
computational resources were supplied by the project einfrastruktura cz einfra lm2018140
provided within the program projects of large research development and innovations infrastructures

references
arregui i n salvador b and vzquez c 2017 cva computing by pde models in numerical analysis
and its applications vol 10187 of lecture notes in comput sci pp 1524 cham springer isbn 9783319570990 doi 10100797833195709902 zbl 136791190 mr3661225
arregui i n salvador b evovi d and vzquez c 2018 total value adjustments for european
options with two stochastic factors mathematical model analysis and numerical simulation comput math
with appl 764 725740 issn 08981221 doi 101016jcamwa201805012 zbl 142691261 mr3830757
baustian f mrzek m pospil j and sobotka t 2017 unifying pricing formula for several stochastic volatility models with jumps appl stoch models bus ind 334 422442 issn 15241904
doi 101002asmb2248 zbl 142091444 mr3690484
black f and scholes m 1973 the pricing of options and corporate liabilities j polit econ 813 637654
issn 00223808 doi 101086260062 zbl 109291524 mr3363443
burgard c and kjaer m 2011a in the balance risk 24 7275 doi 102139ssrn1785262
burgard c and kjaer m 2011b partial differential equation representations of derivatives with bilateral
counterparty risk and funding costs j credit risk 73 7593 doi 1021314jcr2011131
burgard c and kjaer m 2013 funding costs funding strategies risk 26 8287 doi 102139ssrn2027195
castillo d ferreiro a m garcarodrguez j a and vzquez c 2013 numerical methods to
solve pde models for pricing business companies in different regimes and implementation in gpus appl math
comput 21924 1123311257 issn 00963003 doi 101016jamc201305032 zbl 130465186 mr3073276
dahlquist g and ke b 2008 numerical methods in scientific computing vol i society for industrial
and applied mathematics siam philadelphia pa isbn 9780898716443 doi 10113719780898717785
mr2412832
davis p j and rabinowitz p 2007 methods of numerical integration dover publications inc mineola
ny isbn 9780486453392 corrected reprint of the second 1984 edition zbl 113965016 mr2401585
duffie d and huang m 1996 swap rates and credit quality j finance 513 921949 issn 15406261
doi 1023072329227
evans l c 2010 partial differential equations vol 19 of graduate studies in mathematics american mathematical society providence ri second edn isbn 9780821849743 doi 101090gsm019 zbl 119435001
mr2597943
gregory j 2020 the xva challenge counterparty credit risk funding collateral and capital wiley finance
chichester west sussex uk john wiley  sons 4th edn isbn 9781119508977hbk 9781119509004ebook
heston s l 1993 a closedform solution for options with stochastic volatility with applications to bond and
currency options rev financ stud 62 327343 issn 08939454 doi 101093rfs62327 zbl 138435131
mr3929676
hull j and white a 2012 the fva debate risk 25 8385
hull j and white a 2014 valuing derivatives funding value adjustments and fair value financial anal
j 703 4556 doi 102469fajv70n33

14

hull j c 2009 options futures and other derivatives prentice hall 7th edn isbn 9780136015864hbk
hull j c 2018 risk management and financial institutions wiley finance wiley 5th edn isbn 9781119448112hbk 9781119448099ebook
hull j c and white a d 1987 the pricing of options on assets with stochastic volatilities j finance
422 281300 issn 15406261 doi 101111j154062611987tb02568x
int hout k 2017 numerical partial differential equations in finance explained an introduction to computational finance financial engineering explained london uk palgrave macmillan isbn 9781137435682hbk 9781349953813pbk 9781137435699ebook doi 1010579781137435699
jarrow r a and turnbull s m 1995 pricing options on financial securities subject to credit risk j
finance 501 5385 issn 15406261 doi 1023072329239
krylov v i 1962 approximate calculation of integrals translated by arthur h stroud the macmillan co
new yorklondon 1962 zbl 115265005 mr0144464
leveque r j 2007 finite difference methods for ordinary and partial differential equations steadystate
and timedependent problems philadelphia pa society for industrial and applied mathematics siam isbn
9780898716290pbk doi 10113719780898717839 zbl 112765080 mr2378550
merton r c 1973 theory of rational option pricing bell j econ 41 141183 issn 00058556
doi 1023073003143 zbl 125791043 mr0496534
piterbarg v 2010 funding beyond discounting collateral agreements and derivatives pricing risk 23 97102
renzitti s bastani p and sivorot s 2020 accelerating cva and cva sensitivities using quasimonte
carlo methods wilmott 2020108 7893 doi 101002wilm10860
rouah f d 2013 the heston model and its extensions in matlab and c  website wiley finance series
hoboken nj john wiley  sons inc isbn 9781118548257pbk 9781118656471ebook zbl 130491007
rubinstein m 1985 nonparametric tests of alternative option pricing models using all reported trades and
quotes on the 30 most active cboe classes from august 23 1976 through august 31 1978 j finance 402
455480 doi 101111j154062611985tb04967x
rubinstein
m
1994
implied
binomial
trees
j
finance
493
771818
doi 101111j154062611994tb00079x
salvador b and oosterlee c w 2021 total value adjustment for a stochastic volatility model
a comparison with the blackscholes model appl math comput 391 125489 19 issn 00963003
doi 101016jamc2020125489 mr4149125
sorenson e h and bollier t f 1994 pricing swap default risk financial anal j 503 2333 issn
0015198x doi 102469fajv50n323
stein e m and stein j c 1991 stock price distributions with stochastic volatility an analytic approach
rev financ stud 44 727752 issn 08939454 doi 101093rfs44727 zbl 06857133
stoer j and bulirsch r 2002 introduction to numerical analysis vol 12 of texts in applied mathematics
springerverlag new york third edn isbn 038795452x doi 1010079780387217383 zbl 100465001
mr1923481

15

