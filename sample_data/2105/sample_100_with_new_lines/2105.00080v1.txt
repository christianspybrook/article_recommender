entangling quantum generative adversarial networks
murphy yuezhen niu1  alexander zlokapa2 1  michael broughton1
sergio boixo1 masoud mohseni1 vadim smelyanskyi1 and hartmut neven1
arxiv210500080v1 quantph 30 apr 2021
google ai quantum venice ca 90291 usa
division of physics mathematics and astronomy caltech pasadena ca 91125 usa
generative adversarial networks gans are one of the most widely adopted semisupervised and
unsupervised machine learning methods for highdefinition image video and audio generation in
this work we propose a new type of architecture for quantum generative adversarial networks entangling quantum gan eqgan that overcomes some limitations of previously proposed quantum
gans leveraging the entangling power of quantum circuits eqgan guarantees the convergence
to a nash equilibrium under minimax optimization of the discriminator and generator circuits by
performing entangling operations between both the generator output and true quantum data we
show that eqgan has additional robustness against coherent errors and demonstrate the effectiveness of eqgan experimentally in a google sycamore superconducting quantum processor by
adversarially learning efficient representations of quantum states we prepare an approximate quantum random access memory qram and demonstrate its use in applications including the training
of quantum neural networks
introduction
generative adversarial networks gans 1 are one
of the most widely adopted generative machine learning methods achieving stateoftheart performance in a
variety of highdimensional and complex tasks including
photorealistic image generation 2 superresolution 3
and molecular synthesis 4 given access only to a training dataset s  xi  sampled from an underlying data
distribution pdata x a gan can generate realistic examples outside s certain probability distributions generated by quantum computers are thought to be classically
hard to sample from under plausible conjectures 57
and learning to generate these samples using a classical
gan can also be formidably hard 8 in this work we
focus on developing a fully quantum mechanical gan
where the true data is given by a quantum state the
task is then to learn a generator circuit that can reproduce the same quantum state following the framework
of a gan a discriminator circuit is presented either with
the true data or with fake data from the generator the
generator and discriminator are then trained adversarially 9 the generator attempts to fool the discriminator
while the discriminator attempts to correctly distinguish
true and fake data while we focus on quantum data
we present viable applications of the resulting machine
learning architecture in the context of classical data
recent work on a quantum gan qugan 10 11
has proposed a direct analogy of the classical gan architecture in designing the generator and discriminator
circuits we show that the proposed qugan does not
always converge but rather in certain cases oscillates between a finite set of states due to mode collapse and in
general suffers from a nonunique nash equilibrium this
motivates a new entangling quantum gan eqgan
with a uniquely quantum twist rather than providing
the discriminator with either true or fake data we allow
the discriminator to entangle both true and fake data
we prove the convergence of the eqgan to the global
optimal nash equilibrium numerical experiments confirm that the eqgan converges on problem instances
that the qugan failed on
while the eqgan has favorable convergence properties the task of learning a quantum circuit to generate an
unknown quantum state may also be solved in an entirely
supervised approach rather than adversarially training
the discriminator to distinguish between fake and real
data one may freeze the discriminator to perform an exact swap test measuring the state fidelity between the
true and fake data while this would replicate the original state in the absence of noise gate errors in the implementation of the discriminator will cause convergence to
the incorrect optimum we show that the adversarial approach of the eqgan is more robust to such errors than
the simpler supervised learning approach since training
quantum machine learning models can require extensive
time to compute gradients on current quantum hardware
resilience to gate errors drifting during the training process is especially valuable in the noisy intermediatescale
quantum nisq era of quantum computing
finally we provide applications of the eqgan in
the broader context of quantum machine learning for
classical data many of the most attractive quantum
machine learning algorithms require a quantum random
access memory qram 12 by learning a shallow
quantum circuit to generate a superposition of classical
data an eqgan can be used to create an approximate
qram we demonstrate an application of such a qram
for quantum neural networks 13 improving the performance of a quantum neural network for a classification
task
prior art
a gan comprises of a parameterized generative network gg  z and discriminator network dd  z the
generator maps a vector sampled from an input distribution z  p0 z to a data example gg  z thus transforming p0 z to a new distribution pg z of fake data
the discriminator takes an input sample x and gives the
probability dd  x that the sample is real from the
data or fake from the generative network the training
corresponds to a minimax optimization problem where
we alternate between improving the discriminators ability to distinguish realfake samples and improving the
generators ability to fool the discriminator specifically
we solve ming maxd v g  d  for a cost function v 
v g  d   expdata x log dd  x
 ezp0 z log 1  dd  gg  z 
if g and d have enough capacity ie approach the
space of arbitrary functions then it is proven in ref 1
that the global optimum of this minimax game exists
and uniquely corresponds to pg x  pdata x while
a multilayer perceptron can be used to parameterize d
and g the dimensionality of the functional space can
also be increased by replacing classical neural networks
with quantum neural networks in the most general case
the classical
data can be represented by a density matrix
  i pi i ihi  where pi  0 1 are positive bounded
real numbers and i i are orthogonal basis states in the
first proposal of a quantum gan qugan 10 11 the
generative network is defined by a quantum circuit u that
outputs the quantum state   u g 0 u  g  from the
initial state 0  the discriminator takes either the real
data  or the fake data  and performs a positive operator valued measurement povm defined by t whose
outcome determines the probability of data being true
or operator f whose outcome determines the probability
of data being fake with t 1  f 1  1 hence the
discriminator predicts the probability that an unknown
input state in is true data by measuring the expectation
value of t 
dd  in   trt in 
convergence of eqgan
to ensure convergence to a unique nash equilibrium
we propose a new minimax optimization problem with a
discriminator that is not directly analogous to the discriminator of a classical gan rather than evaluating
either fake or true data individually the optimal discriminator is not only provided access to the true data  and
an input state g  prepared by the generator circuit parameterized by g  but also permited to perform a measurement on the joint system that in certain parameter
value gives fidelity measurement between the two inputs
dfid g  
tr  12 g   12
notice that in comparison eq 3 is a linear function of input states which is not optimal in the statecertification
problem 14 of evaluating quantum generative models
let the discriminator d d  g  represent the probability of measuring state 0i at the end of the discriminating circuit if there exist parameters dopt that realize a
perfect swap test ie d dopt  g   21  21 dfid g 
then d is sufficiently expressive to reach the optimal discriminator during optimization since a traditional swap
test across two nqubit states requires twoqubit gates
that span over 2n qubits implementation on a quantum
device with local connectivity incurs prohibitive overhead
in circuit depth hence we implement the discriminator with a parameterized destructive ancillafree swap
test 15 the eqgan architecture adversarially optimizes the generation of the state g  and the learning
of a fidelity measurement d fig 1
we define a minimax cost function closer to that of the
classical gan in eq 1
following ref 11 the qugan solves the minimax game
min max trt   trt g  
cost function in eq 3 perhaps overshooting  in the
subsequent generator update t will again be opposite
to  this leads to the oscillation of the generator and
discriminator possibly preventing convergence we show
a case of infinite oscillation in the supplementary material
unfortunately minimax optimization might not converge to a good nash equilibrium when  is close to
 the optimal hesltrom measurement operator t 
p     is close to orthogonal to the true quantum
data  and opposite to  the next step of training will
try align the generator state  with t to minimize the
min max v g  d   min max1  d d  g 
where d d  g  is the parameterization of the swaptest result we now show that a nash equilibrium exists at the desired location consider a swap test circuit
ansatz for the discriminator u d   expid cswap
which is the matrix exponentiation of a perfect controlled
swap gate with angle d  under such ansatz the input
state in  ih and   ih will transform under
the discriminator circuit into
hu d h0ia ii 
i sin d
1ia ii  ii  0ia eid  cos d ii  i sin d ii
given the circuit ansatz defined above with the predefined range for the swap angle  the maximum value for
distinguishing between two arbitrary states is uniquely
achieved by perfect swap test angle   2 more particularly the probability of measuring state 0i at the
end of the parameterized swap test depends on the swap
angle  according to
d d  g  
1  cos2 d  sin2 d dfid g  7
the discriminator aims to decrease the probablity of
measuring 0i and thus minimize eq 7 by getting close
to d  2 which corresponds to the perfect swap test
given dfid g   1 the next step is for the generator to maximize dfid g  by moving closer to the true
data ultimately the generator cannot improve when
g   
u d
fig 1 eqgan architecture the generator varies g to fool
the discriminator the discriminator varies d to distinguish
the state since an optimal discriminator performs a swap
test the global optimum of the eqgan occurs when g  
 while we include an ancilla qubit in the figure for clarity
we implement a destructive ancillafree swap test 15
the cost function defined in eq 5 does not assume
that the input states  and g  have to be pure states
for simplicity the example we provided in eq 6 does
assume pure state input in the supplementary material we discuss one proposal for eqgan to accommodate mixed state input by replacing the purestate fidelity with a mixed state fidelity measurement moreover other discriminator architectures may be chosen to
ensure the existence of a nash equilibrium in the experiments presented below we use a hardwareefficient
ansatz designed to correct dominant coherent gate errors although a poorly chosen circuit parameterization
may yield a nonconvex loss function landscape and thus
be difficult to optimize by gradient descent this is an
issue shared with the qugan due to the difficulty of expressing arbitrary unitaries as shallow quantum circuits
as well as with classical gans however the eqgan
architecture successfully converges on problem instances
that are unreachable by a fully trained and properly parameterized a qugan see supplementary material
learning to suppress errors
we now show the improved robustness of an eqgan
against gate errors compared to a more straightforward
swap test approach to learning an unknown quantum
state rather than adversarially training the parameterized swap test used as a discriminator in eqgan a
perfect swap test could be applied every iteration by a
frozen discriminator this may also cause the generator
circuit to converge to the true data since the swap test
ensures a unique global optimum
however in the presence of gate errors in the swap test
this unique global optimum will be offset from the true
data since eqgan is agnostic to the precise parameterization of a perfect swap test an appropriate ansatz
can learn to correct coherent errors observed on nearterm quantum hardware in particular the gate parameters such as conditional z phase single qubit z phase
and swap angles in twoqubit entangling gate can drift
and oscillate over the time scale of o10 minutes 16 17
such unknown systematic and timedependent coherent
errors provides significant challenges for applications in
quantum machine learning where gradient computation
and update requires many measurements
the large deviations in singlequbit and twoqubit z
rotation angles can largely be mitigated by including additional singlequbit z phase compensations the effectiveness and importance of such systematic error mitigation is recently demonstrated in the success of achieving thestateofart accuracy in energy estimation for
fermionic molecules 18 in learning the discriminator
circuit that is closest to a true swap test the adversarial learning of eqgan provides a useful paradigm that
may be broadly applicable to improving the fidelity of
other nearterm quantum algorithms
suppose the adversarial discriminator unitary is given
by u d  where u dopt  corresponds to a perfect swap
test in the absence of noise given a tracepreserving
completely positive noisy channel e the discriminator is
replaced by a new unitary operation  d  while a supervised approach would apply an approximate swap test
given by  dopt  the adversarial swap test will generically perform better if there exist parameters d such that
 d   u dopt 2   dopt   u dopt 2  because the
discriminator defines the loss landscape optimized by the
generator the g  produced by eqgan may converge
to a state closer to  than possible by a supervised approach if the parameterization of the noisy unitary  is
general enough to mitigate errors
0 z  x  z  h
u d
extremal
discriminator loss
z h
z h
perfect swap
fig 2 eqgan experiment for learning a singlequbit state
the discriminator u d  is constructed with free z rotation
angles to suppress cz gate errors allowing the generator g 
to converge closer to the true data state  by varying x and
z rotation angles
fig 3 comparison of eqgan and a perfect swap test on
a physical quantum device we experimentally confirm that
the eqgan converges to a higher state overlap by learning
to correct such errors with additional singlequbit rotations
the converged eqgan dashed line coincides with the
iteration where the discriminator loss is minimized
application to qram
as an example we consider the task of learning the superposition 12 0i  1i on a quantum device with noise
fig 2 the discriminator is defined by a swap test with
cz gate providing the necessary twoqubit operation to
learn to correct gate errors however the discriminator
adversarially learns the angles of singlequbit z rotations
insert directly after the cz gate hence the eqgan
obtains a state overlap significantly better than that of
the perfect swap test fig 3 although both methods
do not stay at the optimal point this is typical of noisy
gradient measurements and minimax optimizationafter
convergence to the nash equilibrium discretization can
induce perturbations while nonzero higherorder gradients lead the training to deviate from the global optimum 19
we report the average error after multiple runs of the
eqgan and perfect swap test on an experimental device table i
many quantum machine learning applications require
a quantum random access memory qram to load classical data in superposition 12 more particularly a set
of classical data can be described by the empirical distribution pi  over all possible input data i most quantum
machine learning algorithmsprequire
the conversion from
pi  into a quantum state i pi i i ie a superposition of orthogonal basis states i i representing each single classical data entry with an amplitude proportional
to the square root of the classical probability pi  preparing such a superposition of an arbitrary set of n states
takes on operations at best which ruins the exponential speedup given a suitable ansatz we may use an
eqgan to learn a state approximately equivalent to
the superposition of data
qml model
perfect swap
eqgan
minimum error in state fidelity
24  05  104
06  02  104
table i comparison of eqgan and a perfect swap test
on a sycamore quantum device the error of the eqgan
ie 1  state fidelity is significantly lower than that of the
perfect swap test demonstrating the successful adversarial
training of an errorsuppressed swap test uncertainties show
two standard deviations
a class 0 ansatz
b class 1 ansatz
fig 4 variational qram ansatzes for generating peaks by
learning i parameters 20 class 0 corresponds to a centered
peak and class 1 corresponds to an offset peak
conclusion
a empirical pdf
b variational qram
fig 5 twopeak total dataset sampled from normal distributions n  120 and variational qram of the training
dataset n  60 the variational qram is obtained by
training an eqgan to generate a state  with the shallow
peak ansatz to approximate an exact superposition of states
 the training and test datasets each n  60 are both
balanced between the two classes
to demonstrate a variational qram we consider a
dataset of two peaks sampled from different gaussian
distributions exactly encoding the empirical probability
density function requires a very deep circuit and multiplecontrol rotations similarly preparing a gaussian distribution on a device with planar connectivity requires deep
circuits see supplementary material hence we select
shallow circuit ansatzes fig 4 that generate concatenated exponential functions to approximate a symmetric
peak 20 once trained to approximate the empirical
data distribution the variational qram closely reproduces the original dataset fig 5
training data
exact sampling
variational qram
accuracy
53  6
69  2
table ii test accuracy n  60 of a quantum neural network qnn either trained on the all samples of the training
dataset n  60 for a single epoch or trained on the variational qram for an equal number of circuit evaluations
although the qnn trained on the variational qram did not
have direct access to the original dataset accuracy is evaluated on the raw dataset uncertainties show two standard
deviations
as a proof of principle for using such qram in a quantum machine learning context we train a quantum neural
network 13 and compute hinge loss either by considering
each data entry individually encoded as a quantum circuit or by considering each class individually encoded
as a superposition in variational qram given the same
number of circuit evaluations to compute gradients the
superposition converges to a better accuracy at the end of
training despite using an approximate distribution table ii
motivated by limitations of preexisting quantum gan
architectures in the literature we propose the eqgan
architecture to overcome issues of nonconvexity and
mode collapse we adopt a parameterization of hilbertschmidt norm as the cost function as oppose to trace
distance based on the optimality of hilbertscmidt norm
in statecertification problems similar advantages of
hilbertschmidt norm has been shown in quantum embedding designs of quantum kernel learning 21 other
approaches to a quantum gan may improve a quantum
gans convergence properties  notably recent work
suggests that certain cost functions such as the wasserstein metric may provide more robust convergence 22
however we find that the eqgans shallow discriminator is effective at suppressing device errors and ensures robust convergence in running laboratory quantum
computers making the eqgan particularly relevant for
nearterm applications of quantum computing moreover we demonstrate the first experimental applicaiton
of eqgan using googles cloud quantum computers
in improving the classification accuracy of classical data
using qram this work opens up new directions in utilizing quantum generative models to achieve quantum
speedup in machine learning that necessitates the efficient and highdelity preparation of qram
az acknowledges support from caltechs intelligent
quantum networks and technologies inqnet research program and by the doehep quantised program grant quantum machine learning and quantum
computation frameworks qmlqcf for hep award
number desc0019227
these two authors contributed equally to this work
1 i goodfellow j pougetabadie m mirza b xu
d wardefarley s ozair a courville and y bengio in advances in neural information processing systems
2014 pp 26722680
2 t salimans i goodfellow w zaremba v cheung
a radford x chen and x chen in advances in neural information processing systems edited by d lee
m sugiyama u luxburg i guyon and r garnett
curran associates inc 2016 vol 29 pp 22342242
url httpsproceedingsneuripsccpaper2016
file8a3363abe792db2d8761d6403605aeb7paperpdf
3 c ledig l theis f huszar j caballero a cunningham a acosta a aitken a tejani j totz z wang
et al in proceedings of the ieee conference on computer vision and pattern recognition cvpr 2017
4 e putin a asadulaev y ivanenkov v aladinskiy b sanchezlengeling a aspuruguzik and
a zhavoronkov journal of chemical information
and modeling 58 1194 2018 pmid 29762023
httpsdoiorg101021acsjcim7b00690 url https
doiorg101021acsjcim7b00690
5 s boixo s v isakov v n smelyanskiy r babbush
n ding z jiang j m martinis and h neven arxiv
preprint arxiv160800263 2016
6 s aaronson and a arkhipov in proceedings of
the fortythird annual acm symposium on theory
of computing association for computing machinery
new york ny usa 2011 stoc 11 p 333342
isbn 9781450306911 url httpsdoiorg101145
19936361993682
7 f arute k arya r babbush d bacon j c bardin
r barends r biswas s boixo f g s l brandao
d a buell et al nature 574 505 2019 url https
doiorg101038s4158601916665
8 m y niu a m dai l li a odena z zhao
v smelyanskyi h neven and s boixo arxiv preprint
arxiv201011983 2020
9 c szegedy w zaremba i sutskever j bruna d erhan i goodfellow and r fergus arxiv preprint
arxiv13126199 2013
10 pl dallairedemers and n killoran phys rev a
98 012324 2018 url httpslinkapsorgdoi
101103physreva98012324
11 s lloyd and c weedbrook phys rev lett 121
040502 2018 url httpslinkapsorgdoi10
1103physrevlett121040502
12 j biamonte p wittek n pancotti p rebentrost
n wiebe and s lloyd arxiv161109347 2016
13 e farhi and h neven arxiv preprint arxiv180206002
2018
14 c bdescu r odonnell and j wright in proceedings
of the 51st annual acm sigact symposium on theory
of computing 2019 pp 503514
15 j c garciaescartin and p chamorroposada phys
rev a 87 052330 2013 url httpslinkapsorg
doi101103physreva87052330
16 f arute k arya r babbush d bacon j c bardin
r barends r biswas s boixo f g brandao d a
buell et al arxiv191011333 2019 url https
arxivorgabs191011333
17 f arute k arya r babbush d bacon j c bardin
r barends a bengtsson s boixo m broughton b b
buckley et al arxiv preprint arxiv201007965 2020
18 f arute k arya r babbush d bacon j c bardin
r barends s boixo m broughton b b buckley d a
buell et al science 369 1084 2020 issn 00368075
url httpssciencesciencemagorgcontent369
65071084
19 a brock j donahue and k simonyan arxiv preprint
arxiv180911096 2018
20 n klco and m j savage phys rev a 102
012612 2020 url httpslinkapsorgdoi10
1103physreva102012612
21 s lloyd m schuld a ijaz j izaac and n killoran
arxiv preprint arxiv200103622 2020
22 b t kiani g d palma m marvian zw liu and
s lloyd quantum earth movers distance a new approach to learning quantum data 2021 210103037
23 v bergholm j izaac m schuld c gogolin m s
alam s ahmed j m arrazola c blank a delgado
s jahangiri et al pennylane automatic differentiation of hybrid quantumclassical computations 2020
181104968
24 l mescheder a geiger and s nowozin in pro
ceedings of the 35th international conference on machine learning edited by j dy and a krause
pmlr stockholmsmssan stockholm sweden 2018
vol 80 of proceedings of machine learning research pp
34813490 url httpproceedingsmlrpressv80
mescheder18ahtml
25 s aaronson the complexity of quantum states and
transformations from quantum money to black holes
2016 160705256
mode collapse example of qugan
we provide a concrete example of mode collapse in the
original qugan architecture 10 11 consider a true
data state  and a generator initialized in state  where
each state is defined by
1  cos6 x  sin6 y
1  cos6  sin6
generator
discriminator
training eqgan
while the original qugan architecture is shown to
oscillate indefinitely for an example constructed in the
main text see fig 6 we provide numerical experiments
here to demonstrate the successful convergence of the
proposed eqgan architecture
state fidelity wrt true data
maximizing eq 3 with a helstrom measurement by
decomposing     2  the discriminator will take
t  p      1
2  optimizing over the space of
density matrices the generator will rotate  to be pary
allel to t  also giving 0  1
2  in the next iteration
the discriminator attempts to perform a new helstrom
measurement to distinguish  from 0  but this results in
t 0  p    0    as the generator realigns to match
the new measurement operator we find that 00  
it is now straightforward to see that if the qugan is
trained to fully solve the minimax optimization problem
each iteration it will never converge instead it will always oscillate between states  and 0  neither of which
are the nash equilibrium of the minimax game fig 6
for the qugan performance under such modecollapse
p  
i i ihi  obtained from the positive part of
the spectral decomposition of    if t is the kfold composition of t with itself then the existence of
some k  1 such that t k   is sufficient to ensure
oscillation between k states for a system of n qubits
we may achieve this by preparing the target and initial
state separated by an angle of 3 on the generalized
bloch sphere
qugan partial training
qugan full training
eqgan partial training
eqgan full training
100
120
iteration
loss
fig 7 comparison of qugan 10 11 and eqgan learning the state given by eq 8 full training denotes training the
generator for 50 epochs then the discriminator for 50 epochs
each iteration partial training denotes only 1 epoch per iteration the qugan remains more unstable than eqgan
during training with either training configuration
100
training episodes
150
200
fig 6 performance of qugan 10 11 learning the state
defined in eq 8 with initialization given by eq 9 mode
collapse manifests as an oscillation in the generator and discriminator loss without converging to a global optimum the
implementation is based on the original architecture in pennylane 23
more generally we can consider the oscillation between a finite set of states let the function t  
p     denote the optimal helstrom measurement
in fig 7 we illustrate a subtlety in the oscillatory analysis presented in the main text within the gan formalism the generator and discriminator iteratively optimize
a given loss function when the optimization is allowed
to converge to an extremum of the loss function in the
qugan architecture specifically the result is determined
by a helstrom measurement it is for this case that indefinite oscillation is shown in the case of learning the
state  constructed in the main text oscillation between
states  and 0 result in a constant state overlap of 34
however the iterative optimization procedure to move
towards the optimal helstrom measurement may be only
partly completed ie the generator and discriminator
are not allowed to extremize the loss function with such
a selection of hyperparameters we observe that oscillation between states continues fig 7 leading to unstable
training for the qugan architecture in comparison the
same hyperparameters perform well for the eqgan architecture which steadily approaches the true data state
unstable training is difficult to overcome even in classical gan architectures 24 and thus advances in understanding how to prevent such nonconvergence are consequential for both quantum and classical machine learning
to help ensure stable training of the eqgan architecture we introduce a training procedure that capitalizes on the fact that the discriminator must converge to
a swap test at the optimal nash equilibrium rather
than training both the generator and discriminator from
the beginning we pretrain the eqgan in a supervised
setting in the first phase the discriminator is frozen
with the parameters of a perfect swap test although the
unitary  dopt  may be an imperfect swap test the generator is trained until the loss converges in the second
phase of training the discriminator is allowed to vary adversarially against the generator seeking the parameters
d  in the context of gate errors this second phase may
yield a unitary closer to a true swap test the example
shown in fig 3 of the main text on a physical quantum devices is replicated in fig 8 here showing the two
phases of training and the benefit of an adversarial swap
test in the presence of noise
eqgan discriminator architecture
we implement an ancillafree swap test to perform
state discrimination fig 9 to evaluate the swap
test on a sycamore quantum device we decompose each
cn ot gate into i hczi h operations to use the
native cz gate as discussed in the main text the cz
gate has unstable errors that can be effectively modeled
with z rotations by an unknown angle on either qubit
the eqgan formalism can overcome the singlequbit
phase error by applying rz gates directly after each
cz operation during adversarial training the free angles  are optimized with gradient descent to mitigate the
twoqubit gate error due to the convergence properties
provided by the generative adversarial framework the
discriminator provably converges to the best state discriminator possible this motivates early stopping as
shown in fig 3 when the discriminator loss indicates
that the best state discriminator has been achieved
fig 9 ancillafree swap test between two 3qubit states by
rewriting the controlledswap operation as cnot and toffoli
gates and replacing computational basis operations with classical post processing the swap test can be performed with an
ancillary classical bit
qnn architecture
frozen
adversarial
discriminator discriminator
perfect swap
fig 8 comparison of eqgan and a perfect swap test
for a simulated noise model normally distributed noise on
singlequbit rotations are applied with a systematic bias away
from zero causing the swap test to force convergence to the
incorrect state
we seek to demonstrate an empirical difference in performance between training a quantum neural network
qnn with individual examples of a classical dataset
and with a superposition of data as obtained from a pretrained eqgan to use the native cz twoqubit gate
we implement a rank4 entangling gate g given by
1 0
0 0
0 ei 0 0
g  
0 0 ei 0
0 0
0 1
which is decomposed as shown in fig 10
due to the planar connectivity of a sycamore quantum
device we implement the qnn shown in fig 11 with a
fourqubit data state
rz 2  rx 2  rz 2 
z rx z
rz 2  rx 2  rz 2 
fig 10 decomposition of the twoqubit entangling gate g
used in the qnn ansatz eq 10
0 x
data
fig 11 quantum neural network architecture left and its
corresponding layout on the sycamore device right a fourqubit data state is constructed with the circuits shown in
fig 4 and placed in the datai state on the blue qubits a
readout qubit orange performs parameterized twoqubit interactions shown in fig 10
estimator for each parameter query the output of the
qnn is averaged over 10 trials to reduce any statistical
fluctuations qnns using the final learning rates 10393
for sampling and 10183 for superposition are then evaluated over 50 trials to obtain the final performance reported in table ii with computed standard deviations
adversarial learning without errors
while the main text discusses the benefit of adversarial
learning in the noisy case ie the automatic suppression
of device errors we provide additional motivation here
for using adversarial learning in the noiseless case in
particular we construct an example for which a perfect
swap test fails and adversarial learning successfully generates the true data state fig 12
the qnn is trained in two ways it is either trained via
sampling shown one training example each iteration as
in ref 13 or via superposition shown a superposition
over an entire class each iteration as discussed in the
main text the superposition methodology does not use
an exact superposition of the training dataset instead
it uses a shallow approximation obtained by pretraining
an eqgan we prepare a symmetric concatenation of
exponential functions to approximate a peak with minimal circuit depth in comparison preparing a gaussian
distribution over n qubits requires n1controlled rotations which must be decomposed into 2n1 cz gates to
use the native gate basis see fig 10 of 20 additional
swap operations are required to prepare the state on a
planar architecture given the empirical dataset we may
also prepare an exact superposition of the data following
a state preparation procedure such as that proposed in
ref 25 however this also requires ncontrolled rotations leading to an exponential dependence in the number of qubits all three versions of the qram are shown
in fig 14
to ensure a fair comparison we permit an equal number of queries to the quantum device consequently for
n  60 examples with 30 examples per class training via
sampling is performed for 1 epoch with 60 corresponding
to 60 iterations performed on the quantum device however training via superposition evaluates the superposition of each class 30 times since there are two classes
also accessing the quantum device for 60 iterations
additionally bayesian optimization is used to tune different learning rates for the sampling and superposition
methodologies in simulation we optimize over adam
learning rates from 104 to 101 with 10 random parameter tries and 40 evaluations of the gaussian process
state fidelity wrt true data
100
095
090
perfect swap
085
eqgan
080
075
070
100
150
200
250
300
iteration
fig 12 demonstration of a vanishing gradient for a perfect swap test and convergence for the eqgan while the
swap test cannot be trained by gradient descent the eqgan
achieves a state overlap of 097
z x
fig 13 generator and data circuit with a vanishing gradient given data defined by x and z rotations of 2 and a
generator initialized with zero angles
given the generator ansatz shown in fig 13 define
the data state to have angles 0  0  2 for corresponding rotations rx 0  rz 0  the generator then
optimizes angles   towards achieving full state overlap
p in general the gradient of the state overlap is
2  2 cos2 cos2 by initializing the genera4
tor with     0 the gradient and all higher derivatives of the overlap vanish since a noiseless supervised
learning approach with a perfect swap test can only eval
a exponential peak ansatz
b gaussian peak ansatz
0 y 
0 y 
0 y 
h ry h
h ry
h ry 
cont
h ry 
x z
z h
x z
z h
h ry
h ry 
x z
x z
z h
c exact superposition
h ry h
h ry h
h ry h
h ry 
x z
cont
x z
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry 
x z
z h
z x
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry h
h ry
fig 14 qram ansatzes for n  4 qubits in planar connectivity with a exponential peaks 3 twoqubit gates b gaussian
distribution 21 twoqubit gates and c exact superposition 57 twoqubit gates we adopt ansatz a because circuit depth
scales polynomially for a qram with n qubits while b and c scale exponentially with n
uate the gradient of a state overlap measurement gradient descent will fail to converge to the correct values
on the other hand by allowing the discriminator to
change the issue of a vanishing gradient is circumvented
and the generator learns the data state fig 12 for
simplicity we use the same discriminator architecture as
that used for suppressing errors parameters are optimized with vanilla stochastic gradient descent the eqgan learning rate schedule is manually tuned and we
verify that no selection of learning rate allows the perfect
swap test9 to converge
a probabilistic mixture of the quantum state by sampling from pi  and then prepare the associated state
this obviates the possible double exponential overhead in
learning the full quantum channel that transform a fixed
initial state to the desired mixed state as illustrated in
fig 15
a eqgan for pure state
b eqgan for mixed state
hybrid eqgan for mixedstate
while classical gans use a random latent vector to
generate fake data the quantum gan proposed here and
in the existing literature does not require any such random input this comes with a price especially when
our goal is to learn quantum data in a mixed state as
shown in fig 15 a factor of two overhead in the number
of qubits are needed for mixedstate learning based on
chois theorem
a closer look at the mathematical nature of a mixed
state points us to a more efficient representation through
a hybrid classicalquantum network a mixed state repp2n
resented in the most generic form   i1 pi i ihi  is
specified by a classical probability distribution pi  over
2n discrete variables corresponding to the set of quantum
states i i that diagonalize the density matrix naturally one can efficiently represent the classical part of
this representation pi  with a classical neural network
while a quantum circuit prepares the state i i given parameter set gi  in this way we will be able to output
fig 15 diagram for eqgan architecture based on quantum swap tests a eqgan for learning how to generate
purestate quantum data b eqgan for learning how to
generate mixedstate quantum data the true input data is
represented by  and the fake input data  is prepared by a
unitary circuit ug  the discriminator qnn realizes a unitary transformation represented by ua jointly on the true
data fake data and the ancillary qubit measurement on the
ancillary qubit is used for the cost function similarly to the
eqgan defined in the main text
