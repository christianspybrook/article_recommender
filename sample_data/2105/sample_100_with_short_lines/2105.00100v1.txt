datadriven fullwaveform inversion surrogate
using conditional generative adversarial networks
marcus saraivaac  avelino forechib  jorcy de oliveira netoc  antnio delreyc  thomas raubera

arxiv210500100v1 cslg 30 apr 2021

a

departamento de informtica  centro tecnolgico
universidade federal do esprito santo
vitria esprito santo brazil
 thomasrauberufesbr

b

coordenadoria de engenharia mecnica
instituto federal do esprito santo
aracruz esprito santo brazil
 avelinoforechiifesedubr

c

explorao e produo
petrleo brasileiro sa
vitria esprito santo brazil
 mvsaraiva jorcyneto delreypetrobrascombr
abstractin the oil and gas industry estimating a subsurface velocity field is an essential step in seismic processing
reservoir characterization and hydrocarbon volume calculation
fullwaveform inversion fwi velocity modeling is an iterative
advanced technique that provides an accurate and detailed
velocity field model although at a very high computational cost
due to the physicsbased numerical simulations required at each
fwi iteration in this study we propose a method of generating
velocity field models as detailed as those obtained through fwi
using a conditional generative adversarial network cgan with
multiple inputs the primary motivation of this approach is to
circumvent the extremely high cost of fullwaveform inversion
velocity modeling realworld data were used to train and test
the proposed network architecture and three evaluation metrics
percent error structural similarity index measure and visual
analysis were adopted as quality criteria based on these metrics
the results evaluated upon the test set suggest that the gan was
able to accurately match real fwi generated outputs enabling
it to extract from input data the main geological structures and
lateral velocity variations experimental results indicate that the
proposed method when deployed has the potential to increase
the speed of geophysical reservoir characterization processes
saving on time and computational resources
index termsconditional generative adversarial network
cgan fullwaveform inversion fwi seismic velocity modeling

i i ntroduction
oil industry applications utilize seismic reflection as a
primary indirect method for investigating the properties of subsurface strata this method uses a controlled source of acoustic waves and receiver arrays geophones or hydrophones
to record the transit time and amplitude of acoustic waves
reflected by contrasting rock type interfaces fig 1
during seismic acquisition the same subsurface region is
sampled multiple times from different offsets resulting in
data redundancy the vertical projection of this region on the
surface is called the common midpoint cmp sorting the
we thank petrobras sa for providing computational resources and the
data used in this publication

fig 1 schematic representation of a marine seismic acquisition

data by cmp we can then obtain the socalled cmp gathers
fig 2
to obtain an image of the subsurface area it is then necessary to process the recorded data transit time and amplitude
of the reflected acoustic waves the estimation of an accurate
velocity model is an essential step in seismic processing this
model is used in several steps of the seismic processing including seismic migration normal moveout nmo correction
and timetodepth conversion
seismic migration is a procedure that aims to migrate
seismic events to their correct position and collapse reflections
and diffractions creating a seismic image of the subsurface 1
nmo correction adjusts all cmp seismic traces to a theoretical
zero offset source and receiver at the same position 2
this procedure enables the use of data redundancy to increase
signaltonoise ratio through cmpcorrected gather stacking
fig 2 the velocity model is also important for timetodepth
conversion a necessary step for reservoir characterization and
oil volume estimation 3

fig 2 a schematic representation of normal moveout correction b process
of stacking a synthetic cmp gather after normal moveout correction to
improve the signaltonoise ratio adapted from 4

complex geological settings such as salt domes and folded
or faulted regions require detailed velocity models in order to
form a satisfactory seismic image currently velocity modeling using fullwaveform inversion fwi is an advanced technique providing an accurate and detailed velocity model 5
in this paper we present a method using an imagetoimage
translator pix2pix 6 based on a conditional generative
adversarial network cgan to translate an input poststack
seismic image average tomographic velocity and twoway
time grid into an interval velocity model as detailed as fwi
a seismic data and velocity model
the primary outcome of 3d seismic processing is a seismic image volume seismic volume slices in the acquisition
direction are conventionally referred to as inlines slices perpendicular to the acquisition direction as crosslines slices
perpendicular to the vertical axis as time slices and a vertical
sample vector as a seismic trace fig 3

fig 3 3d representation of seismic image and main slicing directions inline
parallel to seismic acquisition direction crossline perpendicular to seismic
acquisition direction and time slice perpendicular to vertical axis the red
line shows a seismic trace vertical sample vector

seismic volume is among the most important inputs to characterizing hydrocarbon reservoirs after the datas correlation
with well logs it is possible to map the main seismic horizons
and delimit the top and bottom of hydrocarbon reservoirs
a typical workflow for seismic velocity estimation consists
of three steps as follows
1 normal moveout nmo velocity estimation is performed by manually picking velocities that best horizontalize hyperbola reflections on cmp gathers fig 4
this process returns a very smooth average nmo velocity model that can be approximated by a root mean
square velocity for small offsets
2 raybased or grid tomography is an iterative technique
using seismic reflections travel time measurements and
associated amplitudes to calculate seismic velocity 7
seismic tomography delivers a lowfrequency seismic
acoustic velocity model typically up to 23 hz and
commonly takes the nmo velocity as the first input
3 fullwaveform inversion fwi is a seismic inversion
technique initially proposed by 8 and 9 using prestack seismic data raw data from seismic acquisition
to output a detailed interval velocity model
fwi takes an initial lowresolution velocity model as input
to generate synthetic prestack seismic data by wave equation
numerical modeling this synthetic model is then compared
with real data from seismic acquisition fwi iteratively updates this velocity model in order to minimize the difference
between real and synthetic data fig 5
as fwi is performed with prestack seismic data up to
three orders of magnitude greater than the traditional seismic
volume it becomes computationally expensive and timeconsuming the use of this technique has only become industrially feasible in recent years with an increase in processing
power although the theory was established in the 1980s 8
9

fig 4 normal moveout velocity picking the line passing by the red spots
on the central image was manually selected to define the velocity that best
horizontalize the reflections at the cmp gather adapted from 10

fig 5 fwi modeling a real seismogram compared with synthetic seismogram generated from the initial velocity model and b real seismogram compared
with synthetic seismogram generated from the final velocity model from 11

building an fwi velocity model may require from three
months up to a year of construction depending on the seismic acquisition size and geological subsurface complexity
theoretically fwi can estimate a highresolution velocity
model using as initial input a very smooth velocity model in
practice to support the convergence and reduce the number
of iterations it is conventional to take a tomographic velocity
model as input
the fwi velocity model fills the gap between lowfrequency tomographic velocity model and the seismic reflection image volume fig 6 increasing the useful data
bandwidth
b generative adversarial networks gan
convolutional neural networks cnn are getting more
and more popular in geophysical applications typically in
classification and segmentation tasks 12 13 14 15
and 16 moreover recent studies have demonstrated the
feasibility of geophysical modeling using cnns 17 18
and 19

among cnn architectures generative adversarial networks
gan go beyond traditional classification and segmentation
tasks gans stand out for their ability to learn how to mimic
data provided to them by capturing their statistical and spatial
distributions 21
gans are generative models that learn to generalize a rule
of how to transform a random noise vector z to output image y
g  z  y 21 the pix2pix gan architecture proposed by
6 and adopted in this paper is a conditional gan cgan
which has as its input the sum of the random noise vector z
with an image x to find a rule of how to translate this input
to image y g  x z  y
to accomplish this task pix2pix uses two networks competing against each other while one network generates synthesized images a generator the other network judges whether
these images are valid a discriminator generator g is trained
to produce output images that are indistinguishable from the
actual images by a discriminator d which in turn is trained
to improve its performance on detecting the generators fake
images
in cgan the generator output y is connected directly to the
discriminator input together with the image x through the
backpropagation process discriminator classification in real or
fake images provides a signal for the generator to update its
weights and bias thus improving performance the objective
function of a cgan can be expressed by 1


lcgan g d  exy log dx y 


exz log1  dx gx z 

1

where the generator g tries to minimize this objective
function against an adversarial discriminator d that tries to
maximize it 2
fig 6 simplified representation of the information gap between tomographic
velocity model and seismic reflection image volume fwi velocity model fills
this gap adapted from 20

g  arg min max lcgan g d
g

d

2

previous work 22 shows that l1 regularization is beneficial to this process helping the generator g to create sharper
images 3
ll1 g  exyz

h

y  gx z

i
1



3

thus the final objective function for the pix2pix conditional
gan used in this work is 4
g  arg min max lcgan g d  ll1 g
g

d

4

many image processing problems involve transforming one
image into another these problems are often addressed using
algorithms specific to each situation conditional gans are
a general solution with good performance on a variety of
problems 6 fig 7 shows some generic examples using
pix2pix cgan
ii m aterials and m ethods
a data
from a marine seismic acquisition of approximately
680 km2 in the campos basin brazil we used four seismic
volumes
 post stack seismic image
 average tomographic velocity
 twoway time twt grid
 fwi interval velocity
we loaded the data originally in segy format as a 3d
matrix in a python environment using the segyio library 23
the shape of each matrix was 1451  3001  751 where the
x and y samples were spaced 125 m apart and z samples
spaced every 0004 s
preprocessing involved limiting data variability in two
standard deviations to eliminate outliers partially cropping
regions without reflections sea water thickness and later
data normalization using a global maximum and minimum as
parameters 5
xnorm 

x  xmin

xmax  xmin

we divided the data into training and test sets at a ratio of
70 to 30 respectively fig 8 for the training set we
randomly sampled 2000 patches 512  512 for the test set
we randomly sampled 800 patches 512  512 both in the x
direction direction of acquisition
the poststack seismic image average tomographic velocity and twt grid were combined to form a threechannel
image the training pair was composed of this image and the
fwi interval velocity fig 9
b network
we used the pix2pix conditional gan implemented in
pytorch with the unet 24 as a generator and patchgan
6 as the discriminator counterpart
unet is an encoderdecoder architecture with skip connections and patchgan is a special type of classifier network
subdividing the image into 70  70 patches and classifying
each of them as real or fake fig 10 the gan loss is
the average loss of all patches this strategy focuses on the
high frequency of the image data whereas the lowfrequency
content is captured by l1 loss
c experiments
all experiments were performed using an hp z8 workstation with a 24 gb memory quadro p6000 gpu we began
the experiment using only seismic images and associated fwi
velocity as a training pair but the generator produced artificial
high frequency structure images with artifacts fig 11 we
conclude that seismic images alone did not provide enough
information for the network to converge
to obtain better results we added two additional channels
the average tomographic velocity and the twt grid resulting
in a threechannel input image fig 9
although the tomographic interval velocity was inaccurate
it provided a reliable average velocity hence we used average velocity rather than interval velocity twt information
supported the network in better estimating spatial positions
after we extracted the patches randomly once there is a direct
relation between velocity and overburden thickness

5

fig 7 examples using pix2pix gan aerial photos to maps edges to photos
day to night and gray scale to color adapted from 6

fig 8 seismic volume showing the spatial distributions of training and test
sets

percent error is a common metric for quality control in
seismic processing it is defined as 6
pe 

n
1 x yi  y 0 i
 100
n i1
yi

6

ssim is a composite index 7 measuring the similarity
between two signals based on a comparison of their mean
8 variance 9 and correlation coefficient 10
ssimy y 0   f ly y 0  cy y 0  sy y 0 

ly y 0  

2y y0  c1

2y  2y0  c1

8

cy y 0  

2y y0  c2

y2  y20  c2

9

yy0  c3

y y0  c3

10

sy y 0  

fig 9 three channels combined input and fwi velocity patches producing
a training pair

our assumption was that the tomographic average velocity
and the twt grid would function as boundary conditions
helping the network converge to the right interval velocity
the training time for each experiment was approximately four
hours
the generator and discriminator were trained using the
same learning rate lr  2  105  which was established
empirically based on the visual quality of the training set
results we used the stochastic gradient descent method and
the adam solver with momentum parameters 1  05 and
2  0999 the l1 multiplier  was set to 100
the results were evaluated based on three criteria visual
analysis percent error pe and structural similarity index
measure ssim 25

fig 10 schematic representation of the pix2pix network architecture

7

where c1  c2  and c3 are constants to avoid division by
zero setting c3  c22  we obtain the ssim equation 11
ssimy y 0  

2y y0  c1   2yy0  c2 

2y  2y0  c1 y2  y20  c2 

11

iii r esults
our pix2pix gan approach produced an accurate velocity
model using three channels poststack seismic image average
tomographic velocity and twoway time as input fig 12
the chosen metrics show excellent results on the test set
the average percent error was 15 average ssim was
0994 and the generated velocity was visually identical to the
fwi velocity without artifacts verifying that the geological
structures were incorporated into the gan velocity model
the two distributions are very close confirming the metric
results fig 13
the criterion to stop training was set by visual analysis of
the training set results and later confirmed using the percent
error and the ssim results based on the test set both metrics
stabilized between 60 and 80 epochs fig 14 and fig 15

fig 11 fwi velocity compared with one channel gan velocity

fig 12 fwi velocity gan velocity percent error and ssim map over three representative patches shallow intermediate and deep regions from top to
bottom respectively

fig 13 fwi and gan velocity distributions of test set

unexpectedly the onechannel model experiment showed
satisfactory ssim and pe results when compared with the
threechannel model although the visual analysis showed very
poor results
shallower regions presented better results than deeper regions on all metrics fig 12
iv d iscussion
previous works 26 demonstrated the feasibility of using
cnns for onedimensional 1d synthetic seismic inversion

and 27 used cnns to perform seismic inversion with synthetic prestack seismic data conditional unpaired cyclegans 28 were employed to perform forward and inverse
seismic modeling with poststack seismic data and velocity
models while also using synthetic data with a single input
channel poststack seismic image they achieved only qualitatively moderate results gans were also used to generate
prior models to constrain solutions in the traditional fwi
algorithm 29
in this study we apply a conditional pix2pix gan to
generate highly accurate velocity models using real poststack
seismic data with multiple inputs
neural networks are understood to perform better at interpolation than extrapolation tasks 30 31 therefore it is
challenging for a cgan to extrapolate to lower frequencies
using only the poststack seismic image as input however it
becomes easier to interpolate the missing frequencies fig 6
if we combine lower frequency data as input in this case
average tomographic velocity and twt grid this explains
why adding more information helped to improve the results
providing a twt grid and the average tomographic velocity
enabled a depth estimation for each sample which is useful
information for estimating the interval velocity as it increases
with depth
ordinary physicsbased fwi provides better results in shallower regions where the acquisition cables have sufficient
length to capture diving waves 32 and worse results in

3 channels input
1 channel input

percent error 

7
6
5

v c onclusions
4
3
2

0

10

20

30

40
epoch

50

60

70

80

fig 14 percent error versus epochs using test set
100
0994

095

0992
090
ssim

gans are normally difficult to train they are prone to
reduce the output variability or a complete mode collapse 35
different architectures such as variational autoencoders and
autoencoder with perceptual loss need to be tested in order
to avoid such problems

0990
0988

085

0986
080

20

40

075

60

80

3 channels input
1 channel input

070
0

10

20

30

40
epoch

50

60

70

80

fig 15 ssim versus epochs using test set

deeper regions as expected the pix2pix gan captured this
inaccuracy and also produced worse results in deeper regions
fig 12
the l1 regularization loss acts as a global metric minimizing the average loss of all pixels whereas the gan
loss provided by the patchgan discriminator focuses on
highfrequency structures we suspect that the reason the
experiment using one channel presented good pe and ssim
values was that the generator produced a velocity field that
honors the low frequency associated to average velocity good
pe and the high frequency variations good ssim however
producing poorly accurate visual results this result reveals
the difficulty of finding reliable metrics for evaluating gans
33
the major threat to the method is the usage of poorquality
training data despite the robustness of fwi velocity modeling examples where fwi could not converge to an acceptable
velocity model because of seismic acquisition limitations and
low signaltonoise ratio are common 34 if this data were
used to train the model the pix2pix cgan will also produce
a poorquality velocity model

we have presented a method based on a pix2pix conditional
gan with multiple input that can be used to surrogate fwi
velocity modeling the three inputs poststack seismic image
average tomographic velocity and twt grid were vital as the
experiment using only one channel poststack seismic image
failed
further development of new network architectures focused
on seismic data particularities and considering three or more
spatial dimensions may generate an improvement in the quality
of our results
the test data presented excellent results based on pe
ssim and visual analysis the main geological structures and
lateral velocity changes were captured by the resulting velocity
model
once we train the gan it was really fast the generation
of a fwi interval velocity model surrogate almost real time
therefore our proposed method can replace the fwi modeling
or providing an initial velocity model that will need fewer
iterations to converge during traditional fwi similar strategy
adopted by 36
a fair comparison between the fwi and our cgan surrogate model should consider the implementation of the fwi
algorithm in parallel using gpu hardware although some
papers have proposed gpu implementations of the fwi algorithm 37 38 and 39 they only used 2d synthetic data
mainly due to gpu memory constraints at present fwi
algorithm processing on gpu hardware has yet to become
industrially feasible
the proposed method when deployed has the potential to
speed up geophysical reservoir characterization processes saving time and reducing computational resource requirements
r eferences
1 j gazdag and p sguazzero migration of seismic data proceedings
of the ieee vol 72 no 10 pp 13021315 1984
2 o yilmaz seismic data analysis processing inversion and
interpretation of seismic data society of exploration geophysicists
01 2001 online available httpsdoiorg10119019781560801580
3 p schultz the seismic velocity model as an interpretation asset
society of exploration geophysicists 1998
4 g liu s fomel l jin and x chen stacking seismic data using
local correlation geophysics vol 74 2009
5 s kapoor d vigh h li and d derharoutian full waveform inversion for detailed velocity model building in 74th eage conference
and exhibition incorporating europec 2012 european association
of geoscientists  engineers 2012 pp cp293
6 p isola jy zhu t zhou and a a efros imagetoimage translation
with conditional adversarial networks 2018
7 i jones tutorial velocity estimation via raybased tomography first
break vol 28 2010
8 p lailly the seismic inverse problem as a sequence of before stack inversions in conference on inverse scatteringtheory and application
vol 11 siam 1983 p 206

9 a tarantola inversion of seismic reflection data in the acoustic
approximation geophysics vol 49 pp 12591266 1984
10 madagascar development team madagascar software version 14
httpwwwahayorg 2012
11 j virieux a asnaashari r brossier l mtivier a ribodetti and
w zhou an introduction to full waveform inversion in encyclopedia
of exploration geophysics society of exploration geophysicists 2017
pp r11
12 z geng and y wang automated design of a convolutional neural
network with multiscale filters for costefficient seismic data classification nature communications vol 11 2020
13 w xiong x ji y ma y wang n m albinhassan m n ali and
y luo seismic fault detection with convolutional neural network
geophysics vol 83 2018
14 y shi x wu and s fomel saltseg automatic 3d salt segmentation
using a deep convolutional neural network interpretation vol 7 2019
15 x wu l liang y shi and s fomel faultseg3d using synthetic
data sets to train an endtoend convolutional neural network for 3d
seismic fault segmentation geophysics vol 84 2019
16 a b guazzelli m roisenberg and b rodrigues efficient 3d
semantic segmentation of seismic images using orthogonal planes 2d
convolutional neural networks 2020 international joint conference on
neural networks ijcnn pp 18 2020
17 y ren x xu s yang l nie and y chen a physicsbased neuralnetwork way to perform seismic full waveform inversion ieee access
vol 8 pp 112 266112 277 2020
18 b moseley a markham and t nissenmeyer solving the wave
equation with physicsinformed deep learning arxiv computational
physics 2020
19 r zhang y liu and h sun physicsguided convolutional neural
network phycnn for datadriven seismic response modeling arxiv
vol abs190908118 2019
20 j f claerbout imaging the earths interior
blackwell scientific
publications oxford 1985 vol 1
21 i j goodfellow j pougetabadie m mirza b xu d wardefarley
s ozair a c courville and y bengio generative adversarial nets
in nips 2014
22 d pathak p krhenbhl j donahue t darrell and a a efros context encoders feature learning by inpainting 2016 ieee conference
on computer vision and pattern recognition cvpr pp 25362544
2016
23 equinor segyio documentation online available httpssegyio
readthedocsioenlatestindexhtml
24 o ronneberger p fischer and t brox unet convolutional networks
for biomedical image segmentation arxiv vol abs150504597 2015
25 z wang a c bovik h r sheikh s member e p simoncelli and
s member image quality assessment from error visibility to structural
similarity ieee transactions on image processing vol 13 pp 600
612 2004
26 v puzyrev a egorov a pirogova c elders and c otto seismic
inversion with deep neural networks a feasibility analysis in 81st
eage conference and exhibition 2019 vol 2019 no 1 european
association of geoscientists  engineers 2019 pp 15
27 y wu y lin and z zhou inversionnet accurate and efficient seismic
waveform inversion with convolutional neural networks seg technical
program expanded abstracts 2018
28 l mosser w kimman j dramsch s purves a d l fuente and
g ganssle rapid seismic domain transfer seismic velocity inversion
and modeling using deep generative neural networks arxiv vol
abs180508826 2018
29 l mosser o dubrule and m j blunt stochastic seismic
waveform inversion using generative adversarial networks as a
geological prior mathematical geosciences vol 52 no 1 pp 53
79 jan 2020 online available httparxivorgabs180603720http
linkspringercom101007s11004019098326
30 e barnard and l wessels extrapolation and interpolation in neural
network classifiers ieee control systems vol 12 pp 5053 1992
31 k xu j li m zhang s du k kawarabayashi and s jegelka
how neural networks extrapolate from feedforward to graph neural
networks arxiv vol abs200911848 2020
32 w zhou r brossier s operto and j virieux full waveform
inversion of diving  reflected waves for velocity model building with
impedance inversion based on scale separation geophysical journal
international vol 202 pp 15351554 2015

33 a borji pros and cons of gan evaluation measures comput vis
image underst vol 179 pp 4165 2019
34 g yao d wu and sx wang a review on reflectionwaveform
inversion petroleum science vol 17 no 2 pp 334351 2020
35 t salimans i goodfellow w zaremba v cheung a radford
and x chen improved techniques for training gans arxiv preprint
arxiv160603498 2016
36 a w senior r evans j jumper j kirkpatrick l sifre t green
c qin a dek a w nelson a bridgland et al improved protein
structure prediction using potentials from deep learning nature vol
577 no 7792 pp 706710 2020
37 b li wang j gao h zhang and w zhao cudabased acceleration
of full waveform inversion on gpu seg technical program expanded
abstracts 2011
38 j mao r shan wu and b wang multiscale full waveform inversion
using gpu seg technical program expanded abstracts 2012
39 j fang h chen h zhou y rao p sun and j zhang elastic
fullwaveform inversion based on gpu accelerated temporal fourthorder
finitedifference approximation comput geosci vol 135 p 104381
2020

